---
uid: web-forms/overview/older-versions-security/membership/user-based-authorization-vb
title: 사용자 기반 권한 부여 (VB) | Microsoft Docs
author: rick-anderson
description: 이 자습서에서는 다양 한 기술을 통해 페이지에 대 한 액세스를 제한 하 고 페이지 수준 기능을 제한 하는 방법을 살펴보겠습니다.
ms.author: riande
ms.date: 01/18/2008
ms.assetid: bc937e9d-5c14-4fc4-aec7-440da924dd18
msc.legacyurl: /web-forms/overview/older-versions-security/membership/user-based-authorization-vb
msc.type: authoredcontent
ms.openlocfilehash: dfac0c6fa955e59c6ea996533f2447e89ec8d468
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78516377"
---
# <a name="user-based-authorization-vb"></a><span data-ttu-id="89b5a-103">사용자 기반 권한 부여(VB)</span><span class="sxs-lookup"><span data-stu-id="89b5a-103">User-Based Authorization (VB)</span></span>

<span data-ttu-id="89b5a-104">[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="89b5a-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="89b5a-105">[코드 다운로드](https://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_07_VB.zip) 또는 [PDF 다운로드](https://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial07_UserAuth_vb.pdf)</span><span class="sxs-lookup"><span data-stu-id="89b5a-105">[Download Code](https://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_07_VB.zip) or [Download PDF](https://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial07_UserAuth_vb.pdf)</span></span>

> <span data-ttu-id="89b5a-106">이 자습서에서는 다양 한 기술을 통해 페이지에 대 한 액세스를 제한 하 고 페이지 수준 기능을 제한 하는 방법을 살펴보겠습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-106">In this tutorial we will look at limiting access to pages and restricting page-level functionality through a variety of techniques.</span></span>

## <a name="introduction"></a><span data-ttu-id="89b5a-107">소개</span><span class="sxs-lookup"><span data-stu-id="89b5a-107">Introduction</span></span>

<span data-ttu-id="89b5a-108">사용자 계정을 제공 하는 대부분의 웹 응용 프로그램은 특정 방문자가 사이트 내의 특정 페이지에 액세스 하지 못하도록 제한 하는 과정을 포함 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-108">Most web applications that offer user accounts do so in part to restrict certain visitors from accessing certain pages within the site.</span></span> <span data-ttu-id="89b5a-109">예를 들어 대부분의 온라인 messageboard 사이트에서 모든 사용자 (익명 및 인증 됨)는 messageboard의 게시물을 볼 수 있지만, 인증 된 사용자만 웹 페이지를 방문 하 여 새 게시물을 만들 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-109">In most online messageboard sites, for example, all users - anonymous and authenticated - are able to view the messageboard's posts, but only authenticated users can visit the web page to create a new post.</span></span> <span data-ttu-id="89b5a-110">그리고 특정 사용자 (또는 특정 사용자 집합)만 액세스할 수 있는 관리 페이지가 있을 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-110">And there may be administrative pages that are only accessible to a particular user (or a particular set of users).</span></span> <span data-ttu-id="89b5a-111">또한 페이지 수준 기능은 사용자 마다 다를 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-111">Moreover, page-level functionality can differ on a user-by-user basis.</span></span> <span data-ttu-id="89b5a-112">게시물 목록을 볼 때 인증 된 사용자는 각 게시물의 등급을 매기는 인터페이스를 표시 하는 반면,이 인터페이스는 익명 방문자에 게 제공 되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-112">When viewing a list of posts, authenticated users are shown an interface for rating each post, whereas this interface is not available to anonymous visitors.</span></span>

<span data-ttu-id="89b5a-113">ASP.NET를 사용 하면 사용자 기반 권한 부여 규칙을 쉽게 정의할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-113">ASP.NET makes it easy to define user-based authorization rules.</span></span> <span data-ttu-id="89b5a-114">`Web.config`의 특정 웹 페이지 또는 전체 디렉터리는 지정 된 사용자의 하위 집합에만 액세스할 수 있도록 잠글 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-114">With just a bit of markup in `Web.config`, specific web pages or entire directories can be locked down so that they are only accessible to a specified subset of users.</span></span> <span data-ttu-id="89b5a-115">페이지 수준 기능을 사용 하거나 사용 하지 않도록 설정 하거나 사용 하지 않도록 설정할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-115">Page-level functionality can be turned on or off based on the currently logged in user through programmatic and declarative means.</span></span>

<span data-ttu-id="89b5a-116">이 자습서에서는 다양 한 기술을 통해 페이지에 대 한 액세스를 제한 하 고 페이지 수준 기능을 제한 하는 방법을 살펴보겠습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-116">In this tutorial we will look at limiting access to pages and restricting page-level functionality through a variety of techniques.</span></span> <span data-ttu-id="89b5a-117">이제 시작하겠습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-117">Let's get started!</span></span>

## <a name="a-look-at-the-url-authorization-workflow"></a><span data-ttu-id="89b5a-118">URL 권한 부여 워크플로 살펴보기</span><span class="sxs-lookup"><span data-stu-id="89b5a-118">A Look at the URL Authorization Workflow</span></span>

<span data-ttu-id="89b5a-119">[*폼 인증 개요 개요*](../introduction/an-overview-of-forms-authentication-vb.md) 에서 설명한 것 처럼 ASP.NET 런타임이 ASP.NET 리소스에 대 한 요청을 처리 하면 해당 수명 주기 동안 요청이 여러 이벤트를 발생 시킵니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-119">As discussed in the [*An Overview of Forms Authentication*](../introduction/an-overview-of-forms-authentication-vb.md) tutorial, when the ASP.NET runtime processes a request for an ASP.NET resource the request raises a number of events during its lifecycle.</span></span> <span data-ttu-id="89b5a-120">*HTTP 모듈* 은 요청 수명 주기의 특정 이벤트에 대 한 응답으로 코드가 실행 되는 관리 되는 클래스입니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-120">*HTTP Modules* are managed classes whose code is executed in response to a particular event in the request lifecycle.</span></span> <span data-ttu-id="89b5a-121">ASP.NET는 백그라운드에서 필수 작업을 수행 하는 다양 한 HTTP 모듈과 함께 제공 됩니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-121">ASP.NET ships with a number of HTTP Modules that perform essential tasks behind the scenes.</span></span>

<span data-ttu-id="89b5a-122">이러한 HTTP 모듈 중 하나를 [`FormsAuthenticationModule`](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx)합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-122">One such HTTP Module is [`FormsAuthenticationModule`](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx).</span></span> <span data-ttu-id="89b5a-123">이전 자습서에서 설명한 대로 `FormsAuthenticationModule`의 기본 기능은 현재 요청의 id를 확인 하는 것입니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-123">As discussed in previous tutorials, the primary function of the `FormsAuthenticationModule` is to determine the identity of the current request.</span></span> <span data-ttu-id="89b5a-124">쿠키에 있거나 URL에 포함 된 폼 인증 티켓을 검사 하 여이를 수행 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-124">This is accomplished by inspecting the forms authentication ticket, which is either located in a cookie or embedded within the URL.</span></span> <span data-ttu-id="89b5a-125">이 확인은 [`AuthenticateRequest` 이벤트](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx)중에 발생 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-125">This identification takes place during the [`AuthenticateRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx).</span></span>

<span data-ttu-id="89b5a-126">또 다른 중요 한 HTTP 모듈은 [`UrlAuthorizationModule`](https://msdn.microsoft.com/library/system.web.security.urlauthorizationmodule.aspx) [`AuthorizeRequest` 이벤트](https://msdn.microsoft.com/library/system.web.httpapplication.authorizerequest.aspx) 에 대 한 응답으로 발생 합니다 .이는 `AuthenticateRequest` 이벤트 후에 발생 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-126">Another important HTTP Module is the [`UrlAuthorizationModule`](https://msdn.microsoft.com/library/system.web.security.urlauthorizationmodule.aspx), which is raised in response to the [`AuthorizeRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.authorizerequest.aspx) (which happens after the `AuthenticateRequest` event).</span></span> <span data-ttu-id="89b5a-127">`UrlAuthorizationModule`는 `Web.config`에서 구성 태그를 검사 하 여 현재 id에 지정 된 페이지를 방문할 권한이 있는지 여부를 확인 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-127">The `UrlAuthorizationModule` examines configuration markup in `Web.config` to determine whether the current identity has authority to visit the specified page.</span></span> <span data-ttu-id="89b5a-128">이 프로세스를 *URL 권한 부여*라고 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-128">This process is referred to as *URL authorization*.</span></span>

<span data-ttu-id="89b5a-129">1 단계에서 URL 권한 부여 규칙에 대 한 구문을 검토 하지만 먼저 요청에 대 한 권한이 있는지 여부에 따라 `UrlAuthorizationModule`에서 수행 하는 작업을 살펴보겠습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-129">We'll examine the syntax for the URL authorization rules in Step 1, but first let's look at what the `UrlAuthorizationModule` does depending on whether the request is authorized or not.</span></span> <span data-ttu-id="89b5a-130">`UrlAuthorizationModule` 요청에 권한이 부여 된 것으로 확인 되 면 아무 작업도 수행 하지 않고 해당 수명 주기 동안 요청이 계속 됩니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-130">If the `UrlAuthorizationModule` determines that the request is authorized, then it does nothing, and the request continues through its lifecycle.</span></span> <span data-ttu-id="89b5a-131">그러나 요청에 권한이 부여 *되지 않은* 경우 `UrlAuthorizationModule`는 수명 주기를 중단 하 고 `Response` 개체에 [HTTP 401 권한 없음](http://www.checkupdown.com/status/E401.html) 상태를 반환 하도록 지시 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-131">However, if the request is *not* authorized, then the `UrlAuthorizationModule` aborts the lifecycle and instructs the `Response` object to return an [HTTP 401 Unauthorized](http://www.checkupdown.com/status/E401.html) status.</span></span> <span data-ttu-id="89b5a-132">폼 인증을 사용 하는 경우이 http 401 상태는 클라이언트에 반환 되지 않습니다. `FormsAuthenticationModule`에서 HTTP 401 상태를 검색 302 하는 경우이를 로그인 페이지로 [리디렉션합니다](http://www.checkupdown.com/status/E302.html) .</span><span class="sxs-lookup"><span data-stu-id="89b5a-132">When using forms authentication this HTTP 401 status is never returned to the client because if the `FormsAuthenticationModule` detects an HTTP 401 status is modifies it to an [HTTP 302 Redirect](http://www.checkupdown.com/status/E302.html) to the login page.</span></span>

<span data-ttu-id="89b5a-133">그림 1에서는 ASP.NET 파이프라인, `FormsAuthenticationModule`및 권한이 없는 요청이 도착 했을 때의 `UrlAuthorizationModule` 워크플로를 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-133">Figure 1 illustrates the workflow of the ASP.NET pipeline, the `FormsAuthenticationModule`, and the `UrlAuthorizationModule` when an unauthorized request arrives.</span></span> <span data-ttu-id="89b5a-134">특히 그림 1은 익명 사용자에 대 한 액세스를 거부 하는 페이지인 `ProtectedPage.aspx`에 대 한 익명 방문자의 요청을 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-134">In particular, Figure 1 shows a request by an anonymous visitor for `ProtectedPage.aspx`, which is a page that denies access to anonymous users.</span></span> <span data-ttu-id="89b5a-135">방문자가 익명 이기 때문에 `UrlAuthorizationModule`은 요청을 중단 하 고 HTTP 401 권한 없음 상태를 반환 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-135">Since the visitor is anonymous, the `UrlAuthorizationModule` aborts the request and returns an HTTP 401 Unauthorized status.</span></span> <span data-ttu-id="89b5a-136">그런 다음 `FormsAuthenticationModule`는 401 상태를 로그인 페이지로 302 리디렉션으로 변환 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-136">The `FormsAuthenticationModule` then converts the 401 status into a 302 Redirect to login page.</span></span> <span data-ttu-id="89b5a-137">로그인 페이지를 통해 사용자가 인증 되 면 `ProtectedPage.aspx`으로 리디렉션됩니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-137">After the user is authenticated via the login page, he is redirected to `ProtectedPage.aspx`.</span></span> <span data-ttu-id="89b5a-138">이번에는 `FormsAuthenticationModule` 인증 티켓에 따라 사용자를 식별 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-138">This time the `FormsAuthenticationModule` identifies the user based on his authentication ticket.</span></span> <span data-ttu-id="89b5a-139">이제 방문자가 인증 되었으므로 `UrlAuthorizationModule`는 페이지에 대 한 액세스를 허용 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-139">Now that the visitor is authenticated, the `UrlAuthorizationModule` permits access to the page.</span></span>

<span data-ttu-id="89b5a-140">[폼 인증 및 URL 권한 부여 워크플로를 ![합니다.](user-based-authorization-vb/_static/image2.png)](user-based-authorization-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="89b5a-140">[![The Forms Authentication and URL Authorization Workflow](user-based-authorization-vb/_static/image2.png)](user-based-authorization-vb/_static/image1.png)</span></span>

<span data-ttu-id="89b5a-141">**그림 1**: 폼 인증 및 URL 권한 부여 워크플로 ([전체 크기 이미지를 보려면 클릭](user-based-authorization-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="89b5a-141">**Figure 1**: The Forms Authentication and URL Authorization Workflow  ([Click to view full-size image](user-based-authorization-vb/_static/image3.png))</span></span>

<span data-ttu-id="89b5a-142">그림 1에서는 익명 방문자가 익명 사용자가 사용할 수 없는 리소스에 액세스 하려고 할 때 발생 하는 상호 작용을 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-142">Figure 1 depicts the interaction that occurs when an anonymous visitor attempts to access a resource that is not available to anonymous users.</span></span> <span data-ttu-id="89b5a-143">이 경우 익명 방문자가 querystring에서 지정 된 방문 하려던 페이지가 있는 로그인 페이지로 리디렉션됩니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-143">In such a case, the anonymous visitor is redirected to the login page with the page she attempted to visit specified in the querystring.</span></span> <span data-ttu-id="89b5a-144">사용자가 성공적으로 로그온 하면 처음에 보려고 했던 리소스로 자동으로 다시 리디렉션됩니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-144">Once the user has successfully logged on, she will be automatically redirected back to the resource she was initially attempting to view.</span></span>

<span data-ttu-id="89b5a-145">익명 사용자가 무단으로 요청 하는 경우이 워크플로는 간단 하며 방문자가 발생 한 이유와 이유를 쉽게 파악할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-145">When the unauthorized request is made by an anonymous user, this workflow is straightforward and is easy for the visitor to understand what has happened and why.</span></span> <span data-ttu-id="89b5a-146">그러나 `FormsAuthenticationModule`는 인증 된 사용자가 요청한 경우에도 인증 되지 않은 사용자를 로그인 *페이지로 리디렉션합니다.*</span><span class="sxs-lookup"><span data-stu-id="89b5a-146">But keep in mind that the `FormsAuthenticationModule` will redirect *any* unauthorized user to the login page, even if the request is made by an authenticated user.</span></span> <span data-ttu-id="89b5a-147">인증 된 사용자가 권한이 없는 페이지를 방문 하려고 하면이로 인해 사용자 환경이 혼란 스 러 울 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-147">This can result in a confusing user experience if an authenticated user attempts to visit a page for which she lacks authority.</span></span>

<span data-ttu-id="89b5a-148">ASP.NET 페이지 `OnlyTito.aspx`를 Tito로만 accessibly 하기 위해 웹 사이트에 URL 권한 부여 규칙이 구성 되어 있다고 가정 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-148">Imagine that our website had its URL authorization rules configured such that the ASP.NET page `OnlyTito.aspx` was accessibly only to Tito.</span></span> <span data-ttu-id="89b5a-149">이제 Sam이 사이트를 방문 하 여 로그온 한 후 `OnlyTito.aspx`방문 하려고 한다고 가정 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-149">Now, imagine that Sam visits the site, logs on, and then attempts to visit `OnlyTito.aspx`.</span></span> <span data-ttu-id="89b5a-150">`UrlAuthorizationModule`는 요청 수명 주기를 중지 하 고 HTTP 401 권한 없음 상태를 반환 합니다 .이 상태는 `FormsAuthenticationModule` 검색 한 후 Sam을 로그인 페이지로 리디렉션합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-150">The `UrlAuthorizationModule` will halt the request lifecycle and return an HTTP 401 Unauthorized status, which the `FormsAuthenticationModule` will detect and then redirect Sam to the login page.</span></span> <span data-ttu-id="89b5a-151">Sam은 이미 로그인 했으므로 로그인 페이지로 다시 전송 된 이유를 궁금할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-151">Since Sam has already logged in, though, she may wonder why she has been sent back to the login page.</span></span> <span data-ttu-id="89b5a-152">그녀의 로그인 자격 증명이 손실 되었거나 잘못 된 자격 증명을 입력 했을 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-152">She might reason that her login credentials were lost somehow, or that she entered invalid credentials.</span></span> <span data-ttu-id="89b5a-153">Sam이 로그인 페이지에서 자격 증명을 후 하는 경우 (다시) 로그온 하 여 `OnlyTito.aspx`으로 리디렉션됩니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-153">If Sam reenters her credentials from the login page she will be logged on (again) and redirected to `OnlyTito.aspx`.</span></span> <span data-ttu-id="89b5a-154">`UrlAuthorizationModule`는 Sam이이 페이지를 방문할 수 없다는 것을 감지 하 여 로그인 페이지로 반환 됩니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-154">The `UrlAuthorizationModule` will detect that Sam cannot visit this page and she will be returned to the login page.</span></span>

<span data-ttu-id="89b5a-155">그림 2에서는 이러한 혼란 스러운 워크플로를 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-155">Figure 2 depicts this confusing workflow.</span></span>

<span data-ttu-id="89b5a-156">[기본 워크플로를 ![하면 혼동 될 수 있습니다.](user-based-authorization-vb/_static/image5.png)](user-based-authorization-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="89b5a-156">[![The Default Workflow Can Lead to a Confusing Cycle](user-based-authorization-vb/_static/image5.png)](user-based-authorization-vb/_static/image4.png)</span></span>

<span data-ttu-id="89b5a-157">**그림 2**: 기본 워크플로는 혼동 될 수 있습니다 ([전체 크기 이미지를 보려면 클릭](user-based-authorization-vb/_static/image6.png)).</span><span class="sxs-lookup"><span data-stu-id="89b5a-157">**Figure 2**: The Default Workflow Can Lead to a Confusing Cycle  ([Click to view full-size image](user-based-authorization-vb/_static/image6.png))</span></span>

<span data-ttu-id="89b5a-158">그림 2에 설명 된 워크플로를 통해 대부분의 컴퓨터에 많은 방문자가 신속 하 게 befuddle 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-158">The workflow illustrated in Figure 2 can quickly befuddle even the most computer savvy visitor.</span></span> <span data-ttu-id="89b5a-159">2 단계에서 이러한 혼란 스 사이클을 방지 하는 방법을 살펴보겠습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-159">We will look at ways to prevent this confusing cycle in Step 2.</span></span>

> [!NOTE]
> <span data-ttu-id="89b5a-160">ASP.NET는 두 가지 메커니즘을 사용 하 여 현재 사용자가 특정 웹 페이지에 액세스할 수 있는지 여부를 확인 합니다. URL 권한 부여 및 파일 권한 부여입니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-160">ASP.NET uses two mechanisms to determine whether the current user can access a particular web page: URL authorization and file authorization.</span></span> <span data-ttu-id="89b5a-161">파일 권한 부여는 요청 된 파일 Acl을 확인 하 여 권한을 결정 하는 [`FileAuthorizationModule`](https://msdn.microsoft.com/library/system.web.security.fileauthorizationmodule.aspx)에 의해 구현 됩니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-161">File authorization is implemented by the [`FileAuthorizationModule`](https://msdn.microsoft.com/library/system.web.security.fileauthorizationmodule.aspx), which determines authority by consulting the requested file(s) ACLs.</span></span> <span data-ttu-id="89b5a-162">Acl은 Windows 계정에 적용 되는 권한 이므로 파일 권한 부여는 Windows 인증에서 가장 일반적으로 사용 됩니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-162">File authorization is most commonly used with Windows authentication because ACLs are permissions that apply to Windows accounts.</span></span> <span data-ttu-id="89b5a-163">폼 인증을 사용 하는 경우 사이트를 방문 하는 사용자에 관계 없이 모든 운영 체제 및 파일 시스템 수준 요청은 동일한 Windows 계정에서 실행 됩니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-163">When using forms authentication, all operating system- and file system-level requests are executed by the same Windows account, regardless of the user visiting the site.</span></span> <span data-ttu-id="89b5a-164">이 자습서 시리즈는 폼 인증을 중심으로 하므로 파일 권한 부여에 대해서는 다루지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-164">Since this tutorial series focuses on forms authentication, we will not be discussing file authorization.</span></span>

### <a name="the-scope-of-url-authorization"></a><span data-ttu-id="89b5a-165">URL 권한 부여 범위</span><span class="sxs-lookup"><span data-stu-id="89b5a-165">The Scope of URL Authorization</span></span>

<span data-ttu-id="89b5a-166">`UrlAuthorizationModule`는 ASP.NET 런타임의 일부인 관리 코드입니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-166">The `UrlAuthorizationModule` is managed code that is part of the ASP.NET runtime.</span></span> <span data-ttu-id="89b5a-167">Microsoft의 [인터넷 정보 서비스 (iis)](https://www.iis.net/) 웹 서버 버전 7 이전에는 IIS의 HTTP 파이프라인과 ASP.NET 런타임의 파이프라인 사이에 별도의 장애가 있었습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-167">Prior to version 7 of Microsoft's [Internet Information Services (IIS)](https://www.iis.net/) web server, there was a distinct barrier between IIS's HTTP pipeline and the ASP.NET runtime's pipeline.</span></span> <span data-ttu-id="89b5a-168">간단히 말해서 IIS 6 및 이전 버전에서는 ASP. NET `UrlAuthorizationModule`는 요청이 IIS에서 ASP.NET 런타임으로 위임 된 경우에만 실행 됩니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-168">In short, in IIS 6 and earlier, ASP.NET's `UrlAuthorizationModule` only executes when a request is delegated from IIS to the ASP.NET runtime.</span></span> <span data-ttu-id="89b5a-169">기본적으로 IIS는 HTML 페이지와 CSS, JavaScript, 이미지 파일 등의 정적 콘텐츠 자체를 처리 하 고 `.aspx`, `.asmx`또는 `.ashx`의 확장명이 있는 페이지가 요청 된 경우에만 ASP.NET 런타임으로 요청을 전달 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-169">By default, IIS processes static content itself - like HTML pages and CSS, JavaScript, and image files - and only hands off requests to the ASP.NET runtime when a page with an extension of `.aspx`, `.asmx`, or `.ashx` is requested.</span></span>

<span data-ttu-id="89b5a-170">그러나 IIS 7에서는 통합 IIS 및 ASP.NET 파이프라인을 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-170">IIS 7, however, allows for integrated IIS and ASP.NET pipelines.</span></span> <span data-ttu-id="89b5a-171">몇 가지 구성 설정을 사용 하 여 모든 요청에 대해 URL 권한 부여 규칙을 정의할 수 있는 *모든* 요청에 대해 `UrlAuthorizationModule`를 호출 하는 IIS 7을 설치할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-171">With a few configuration settings you can setup IIS 7 to invoke the `UrlAuthorizationModule` for *all* requests, meaning that URL authorization rules can be defined for files of any type.</span></span> <span data-ttu-id="89b5a-172">또한 IIS 7에는 자체 URL 권한 부여 엔진이 포함 되어 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-172">Additionally, IIS 7 includes its own URL authorization engine.</span></span> <span data-ttu-id="89b5a-173">ASP.NET integration 및 IIS 7의 기본 URL 인증 기능에 대 한 자세한 내용은 [IIS7 Url 권한 부여 이해](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/URL-Authorization/Understanding-IIS7-URL-Authorization)를 참조 하세요.</span><span class="sxs-lookup"><span data-stu-id="89b5a-173">For more information on ASP.NET integration and IIS 7's native URL authorization functionality, see [Understanding IIS7 URL Authorization](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/URL-Authorization/Understanding-IIS7-URL-Authorization).</span></span> <span data-ttu-id="89b5a-174">ASP.NET 및 IIS 7 통합에 대 한 자세한 내용은 Shahram Khosravi의 서적, *전문 IIS 7 및 ASP.NET 통합 프로그래밍* (ISBN: 978-0470152539)의 복사본을 선택 하세요.</span><span class="sxs-lookup"><span data-stu-id="89b5a-174">For a more in-depth look at ASP.NET and IIS 7 integration, pick up a copy of Shahram Khosravi's book, *Professional IIS 7 and ASP.NET Integrated Programming* (ISBN: 978-0470152539).</span></span>

<span data-ttu-id="89b5a-175">간단히 말해서 IIS 7 이전 버전에서 URL 권한 부여 규칙은 ASP.NET 런타임에 의해 처리 되는 리소스에만 적용 됩니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-175">In a nutshell, in versions prior to IIS 7, URL authorization rules are only applied to resources handled by the ASP.NET runtime.</span></span> <span data-ttu-id="89b5a-176">그러나 IIS 7을 사용 하면 IIS의 기본 URL 권한 부여 기능을 사용 하거나 ASP를 통합할 수 있습니다. NET은 IIS의 HTTP 파이프라인에 `UrlAuthorizationModule` 하 여이 기능을 모든 요청으로 확장 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-176">But with IIS 7 it is possible to use IIS's native URL authorization feature or to integrate ASP.NET's `UrlAuthorizationModule` into IIS's HTTP pipeline, thereby extending this functionality to all requests.</span></span>

> [!NOTE]
> <span data-ttu-id="89b5a-177">ASP에 대 한 몇 가지 사소한 차이점이 있습니다. NET의 `UrlAuthorizationModule` 및 IIS 7의 URL 권한 부여 기능은 권한 부여 규칙을 처리 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-177">There are some subtle yet important differences in how ASP.NET's `UrlAuthorizationModule` and IIS 7's URL authorization feature process the authorization rules.</span></span> <span data-ttu-id="89b5a-178">이 자습서에서는 IIS 7의 URL 권한 부여 기능 또는 `UrlAuthorizationModule`와 비교 하 여 권한 부여 규칙을 구문 분석 하는 방법의 차이점을 검사 하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-178">This tutorial does not examine IIS 7's URL authorization functionality or the differences in how it parses authorization rules compared to the `UrlAuthorizationModule`.</span></span> <span data-ttu-id="89b5a-179">이러한 항목에 대 한 자세한 내용은 MSDN 또는 [www.iis.net](https://www.iis.net/)에서 IIS 7 설명서를 참조 하십시오.</span><span class="sxs-lookup"><span data-stu-id="89b5a-179">For more information on these topics, refer to the IIS 7 documentation on MSDN or at [www.iis.net](https://www.iis.net/).</span></span>

## <a name="step-1-defining-url-authorization-rules-inwebconfig"></a><span data-ttu-id="89b5a-180">1 단계:`Web.config`에서 URL 권한 부여 규칙 정의</span><span class="sxs-lookup"><span data-stu-id="89b5a-180">Step 1: Defining URL Authorization Rules in`Web.config`</span></span>

<span data-ttu-id="89b5a-181">`UrlAuthorizationModule`는 응용 프로그램의 구성에 정의 된 URL 권한 부여 규칙에 따라 특정 id에 대해 요청 된 리소스에 대 한 액세스를 허용 하거나 거부할지를 결정 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-181">The `UrlAuthorizationModule` determines whether to grant or deny access to a requested resource for a particular identity based on the URL authorization rules defined in the application's configuration.</span></span> <span data-ttu-id="89b5a-182">권한 부여 규칙은 `<allow>` 및 `<deny>` 자식 요소 형식으로 [`<authorization>` 요소](https://msdn.microsoft.com/library/8d82143t.aspx) 에서 주석으로 처리 됩니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-182">The authorization rules are spelled out in the [`<authorization>` element](https://msdn.microsoft.com/library/8d82143t.aspx) in the form of `<allow>` and `<deny>` child elements.</span></span> <span data-ttu-id="89b5a-183">각 `<allow>` 및 `<deny>` 자식 요소는 다음을 지정할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-183">Each `<allow>` and `<deny>` child element can specify:</span></span>

- <span data-ttu-id="89b5a-184">특정 사용자</span><span class="sxs-lookup"><span data-stu-id="89b5a-184">A particular user</span></span>
- <span data-ttu-id="89b5a-185">쉼표로 구분 된 사용자 목록입니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-185">A comma-delimited list of users</span></span>
- <span data-ttu-id="89b5a-186">모든 익명 사용자는 물음표 (?)로 표시 됩니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-186">All anonymous users, denoted by a question mark (?)</span></span>
- <span data-ttu-id="89b5a-187">별표 (\*)로 표시 된 모든 사용자</span><span class="sxs-lookup"><span data-stu-id="89b5a-187">All users, denoted by an asterisk (\*)</span></span>

<span data-ttu-id="89b5a-188">다음 태그는 URL 권한 부여 규칙을 사용 하 여 사용자에 게 Tito와 Scott을 허용 하 고 다른 모든 항목을 거부 하는 방법을 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-188">The following markup illustrates how to use the URL authorization rules to allow users Tito and Scott and deny all others:</span></span>

[!code-xml[Main](user-based-authorization-vb/samples/sample1.xml)]

<span data-ttu-id="89b5a-189">`<allow>` 요소는 사용자에 게 허용 되는 사용자 (Tito와 Scott)를 정의 하는 반면 `<deny>` 요소는 *모든* 사용자가 거부 됨을 지시 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-189">The `<allow>` element defines what users are permitted - Tito and Scott - while the `<deny>` element instructs that *all* users are denied.</span></span>

> [!NOTE]
> <span data-ttu-id="89b5a-190">또한 `<allow>` 및 `<deny>` 요소는 역할에 대 한 권한 부여 규칙을 지정할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-190">The `<allow>` and `<deny>` elements can also specify authorization rules for roles.</span></span> <span data-ttu-id="89b5a-191">이후 자습서에서 역할 기반 권한 부여를 살펴보겠습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-191">We will examine role-based authorization in a future tutorial.</span></span>

<span data-ttu-id="89b5a-192">다음 설정은 익명 방문자를 비롯 하 여 Sam 이외의 사용자에 게 액세스 권한을 부여 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-192">The following setting grants access to anyone other than Sam (including anonymous visitors):</span></span>

[!code-xml[Main](user-based-authorization-vb/samples/sample2.xml)]

<span data-ttu-id="89b5a-193">인증 된 사용자만 허용 하려면 모든 익명 사용자에 대 한 액세스를 거부 하는 다음 구성을 사용 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-193">To allow only authenticated users, use the following configuration, which denies access to all anonymous users:</span></span>

[!code-xml[Main](user-based-authorization-vb/samples/sample3.xml)]

<span data-ttu-id="89b5a-194">권한 부여 규칙은 `Web.config`의 `<system.web>` 요소 내에 정의 되며 웹 응용 프로그램의 모든 ASP.NET 리소스에 적용 됩니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-194">The authorization rules are defined within the `<system.web>` element in `Web.config` and apply to all of the ASP.NET resources in the web application.</span></span> <span data-ttu-id="89b5a-195">응용 프로그램에는 다양 한 섹션에 대 한 서로 다른 권한 부여 규칙이 있을 때가 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-195">Oftentimes, an application has different authorization rules for different sections.</span></span> <span data-ttu-id="89b5a-196">예를 들어, 전자 상거래 사이트에서 모든 방문자는 제품을 정독 하 고, 제품 리뷰를 참조 하 고, 카탈로그를 검색 하는 등의 방법을 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-196">For example, at an eCommerce site, all visitors may peruse the products, see product reviews, search the catalog, and so on.</span></span> <span data-ttu-id="89b5a-197">그러나 인증 된 사용자만이 체크 아웃 또는 페이지에 연결 하 여 한 번의 배송 기록을 관리할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-197">However, only authenticated users may reach the checkout or the pages to manage one's shipping history.</span></span> <span data-ttu-id="89b5a-198">또한 사이트에는 사이트 관리자와 같은 선택 사용자만 액세스할 수 있는 부분이 있을 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-198">Moreover, there may be portions of the site that are only accessible by select users, such as site administrators.</span></span>

<span data-ttu-id="89b5a-199">ASP.NET를 사용 하면 사이트의 서로 다른 파일 및 폴더에 대 한 다양 한 권한 부여 규칙을 쉽게 정의할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-199">ASP.NET makes it easy to define different authorization rules for different files and folders in the site.</span></span> <span data-ttu-id="89b5a-200">루트 폴더의 `Web.config` 파일에 지정 된 권한 부여 규칙은 사이트의 모든 ASP.NET 리소스에 적용 됩니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-200">The authorization rules specified in the root folder's `Web.config` file apply to all ASP.NET resources in the site.</span></span> <span data-ttu-id="89b5a-201">그러나 `<authorization>` 섹션에 `Web.config`를 추가 하 여 특정 폴더에 대해 이러한 기본 권한 부여 설정을 재정의할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-201">However, these default authorization settings can be overridden for a particular folder by adding a `Web.config` with an `<authorization>` section.</span></span>

<span data-ttu-id="89b5a-202">인증 된 사용자만 `Membership` 폴더의 ASP.NET 페이지를 방문할 수 있도록 웹 사이트를 업데이트 해 보겠습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-202">Let's update our website so that only authenticated users can visit the ASP.NET pages in the `Membership` folder.</span></span> <span data-ttu-id="89b5a-203">이를 수행 하려면 `Membership` 폴더에 `Web.config` 파일을 추가 하 고 익명 사용자를 거부 하도록 권한 부여 설정을 설정 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-203">To accomplish this we need to add a `Web.config` file to the `Membership` folder and set its authorization settings to deny anonymous users.</span></span> <span data-ttu-id="89b5a-204">솔루션 탐색기에서 `Membership` 폴더를 마우스 오른쪽 단추로 클릭 하 고 상황에 맞는 메뉴에서 새 항목 추가 메뉴를 선택한 다음 `Web.config`라는 새 웹 구성 파일을 추가 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-204">Right-click the `Membership` folder in the Solution Explorer, choose the Add New Item menu from the context menu, and add a new Web Configuration File named `Web.config`.</span></span>

<span data-ttu-id="89b5a-205">[멤버 자격 폴더에 web.config 파일을 추가 ![](user-based-authorization-vb/_static/image8.png)](user-based-authorization-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="89b5a-205">[![Add a Web.config File to the Membership Folder](user-based-authorization-vb/_static/image8.png)](user-based-authorization-vb/_static/image7.png)</span></span>

<span data-ttu-id="89b5a-206">**그림 3**: `Membership` 폴더에 `Web.config` 파일 추가 ([전체 크기 이미지를 보려면 클릭](user-based-authorization-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="89b5a-206">**Figure 3**: Add a `Web.config` File to the `Membership` Folder  ([Click to view full-size image](user-based-authorization-vb/_static/image9.png))</span></span>

<span data-ttu-id="89b5a-207">이 시점에서 프로젝트는 두 개의 `Web.config` 파일을 포함 해야 합니다. 하나는 루트 디렉터리에 있고 하나는 `Membership` 폴더에 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-207">At this point your project should contain two `Web.config` files: one in the root directory and one in the `Membership` folder.</span></span>

<span data-ttu-id="89b5a-208">[이제 응용 프로그램에 두 개의 Web.config 파일이 포함 되어 있어야 합니다. ![](user-based-authorization-vb/_static/image11.png)](user-based-authorization-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="89b5a-208">[![Your Application Should Now Contain Two Web.config Files](user-based-authorization-vb/_static/image11.png)](user-based-authorization-vb/_static/image10.png)</span></span>

<span data-ttu-id="89b5a-209">**그림 4**: 이제 응용 프로그램에 두 개의 `Web.config` 파일이 포함 되어 있어야 합니다 ([전체 크기 이미지를 보려면 클릭](user-based-authorization-vb/_static/image12.png)).</span><span class="sxs-lookup"><span data-stu-id="89b5a-209">**Figure 4**: Your Application Should Now Contain Two `Web.config` Files  ([Click to view full-size image](user-based-authorization-vb/_static/image12.png))</span></span>

<span data-ttu-id="89b5a-210">익명 사용자에 대 한 액세스를 금지 하도록 `Membership` 폴더의 구성 파일을 업데이트 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-210">Update the configuration file in the `Membership` folder so that it prohibits access to anonymous users.</span></span>

[!code-xml[Main](user-based-authorization-vb/samples/sample4.xml)]

<span data-ttu-id="89b5a-211">이제 모든 작업을 마쳤습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-211">That's all there is to it!</span></span>

<span data-ttu-id="89b5a-212">이 변경 내용을 테스트 하려면 브라우저에서 홈 페이지를 방문 하 여 로그 아웃 되었는지 확인 합니다. ASP.NET 응용 프로그램의 기본 동작은 모든 방문자를 허용 하는 것이 고, 루트 디렉터리의 `Web.config` 파일에 대 한 권한 부여 수정 작업을 수행 하지 않았기 때문에, 루트 디렉터리의 파일을 익명 방문자로 방문할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-212">To test out this change, visit the homepage in a browser and make sure you are logged out. Since the default behavior of an ASP.NET application is to allow all visitors, and since we didn't make any authorization modifications to the root directory's `Web.config` file, we are able to visit the files in the root directory as an anonymous visitor.</span></span>

<span data-ttu-id="89b5a-213">왼쪽 열에 있는 사용자 계정 만들기 링크를 클릭 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-213">Click on the Creating User Accounts link found in the left column.</span></span> <span data-ttu-id="89b5a-214">그러면 `~/Membership/CreatingUserAccounts.aspx`으로 이동 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-214">This will take you to the `~/Membership/CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="89b5a-215">`Membership` 폴더의 `Web.config` 파일은 익명 액세스를 금지 하는 권한 부여 규칙을 정의 하므로 `UrlAuthorizationModule`에서 요청을 중단 하 고 HTTP 401 권한 없음 상태를 반환 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-215">Since the `Web.config` file in the `Membership` folder defines authorization rules to prohibit anonymous access, the `UrlAuthorizationModule` aborts the request and returns an HTTP 401 Unauthorized status.</span></span> <span data-ttu-id="89b5a-216">`FormsAuthenticationModule`는이를 302 리디렉션 상태로 수정 하 여 로그인 페이지로 보냅니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-216">The `FormsAuthenticationModule` modifies this to a 302 Redirect status, sending us to the login page.</span></span> <span data-ttu-id="89b5a-217">액세스 하려는 페이지 (`CreatingUserAccounts.aspx`)는 `ReturnUrl` querystring 매개 변수를 통해 로그인 페이지로 전달 됩니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-217">Note that the page we were attempting to access (`CreatingUserAccounts.aspx`) is passed to the login page via the `ReturnUrl` querystring parameter.</span></span>

<span data-ttu-id="89b5a-218">[![는 URL 권한 부여 규칙에서 익명 액세스를 금지 하므로 로그인 페이지로 리디렉션됩니다.](user-based-authorization-vb/_static/image14.png)](user-based-authorization-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="89b5a-218">[![Since the URL Authorization Rules Prohibit Anonymous Access, We are Redirected to the Login Page](user-based-authorization-vb/_static/image14.png)](user-based-authorization-vb/_static/image13.png)</span></span>

<span data-ttu-id="89b5a-219">**그림 5**: URL 권한 부여 규칙이 익명 액세스를 금지 하므로 로그인 페이지로 리디렉션됩니다 ([전체 크기 이미지를 보려면 클릭](user-based-authorization-vb/_static/image15.png)).</span><span class="sxs-lookup"><span data-stu-id="89b5a-219">**Figure 5**: Since the URL Authorization Rules Prohibit Anonymous Access, We are Redirected to the Login Page  ([Click to view full-size image](user-based-authorization-vb/_static/image15.png))</span></span>

<span data-ttu-id="89b5a-220">성공적으로 로그인 하면 `CreatingUserAccounts.aspx` 페이지로 리디렉션됩니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-220">Upon successfully logging in, we are redirected to the `CreatingUserAccounts.aspx` page.</span></span> <span data-ttu-id="89b5a-221">이번에는 `UrlAuthorizationModule`가 더 이상 익명이 아니기 때문에 페이지에 대 한 액세스를 허용 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-221">This time the `UrlAuthorizationModule` permits access to the page because we are no longer anonymous.</span></span>

### <a name="applying-url-authorization-rules-to-a-specific-location"></a><span data-ttu-id="89b5a-222">특정 위치에 URL 권한 부여 규칙 적용</span><span class="sxs-lookup"><span data-stu-id="89b5a-222">Applying URL Authorization Rules to a Specific Location</span></span>

<span data-ttu-id="89b5a-223">`Web.config`의 `<system.web>` 섹션에 정의 된 권한 부여 설정은 해당 디렉터리 및 해당 하위 디렉터리에 있는 모든 ASP.NET 리소스에 적용 됩니다 (다른 `Web.config` 파일에서 다른 방법으로 재정의 될 때까지).</span><span class="sxs-lookup"><span data-stu-id="89b5a-223">The authorization settings defined in the `<system.web>` section of `Web.config` apply to all of the ASP.NET resources in that directory and its subdirectories (until otherwise overridden by another `Web.config` file).</span></span> <span data-ttu-id="89b5a-224">그러나 일부 경우에는 지정 된 디렉터리의 모든 ASP.NET 리소스가 특정 한 두 페이지를 제외 하 고 특정 권한 부여 구성을 갖도록 할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-224">In some cases, though, we may want all ASP.NET resources in a given directory to have a particular authorization configuration except for one or two specific pages.</span></span> <span data-ttu-id="89b5a-225">이렇게 하려면 `Web.config`에서 `<location>` 요소를 추가 하 고, 권한 부여 규칙이 다른 파일을 가리키고, 포함 된 고유한 권한 부여 규칙을 정의 하면 됩니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-225">This can be achieved by adding a `<location>` element in `Web.config`, pointing it to the file whose authorization rules differ, and defining its unique authorization rules therein.</span></span>

<span data-ttu-id="89b5a-226">`<location>` 요소를 사용 하 여 특정 리소스에 대 한 구성 설정을 재정의 하는 방법에 대해 설명 하기 위해 Tito에서 `CreatingUserAccounts.aspx`를 방문할 수 있도록 권한 부여 설정을 사용자 지정 하겠습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-226">To illustrate using the `<location>` element to override the configuration settings for a specific resource, let's customize the authorization settings so that only Tito can visit `CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="89b5a-227">이 작업을 수행 하려면 `Membership` 폴더의 `Web.config` 파일에 `<location>` 요소를 추가 하 고 다음과 같이 표시 되도록 태그를 업데이트 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-227">To accomplish this, add a `<location>` element to the `Membership` folder's `Web.config` file and update its markup so that it looks like the following:</span></span>

[!code-xml[Main](user-based-authorization-vb/samples/sample5.xml)]

<span data-ttu-id="89b5a-228">`<system.web>`의 `<authorization>` 요소는 `Membership` 폴더와 해당 하위 폴더의 ASP.NET 리소스에 대 한 기본 URL 권한 부여 규칙을 정의 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-228">The `<authorization>` element in `<system.web>` defines the default URL authorization rules for ASP.NET resources in the `Membership` folder and its subfolders.</span></span> <span data-ttu-id="89b5a-229">`<location>` 요소를 사용 하면 특정 리소스에 대해 이러한 규칙을 재정의할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-229">The `<location>` element allows us to override these rules for a particular resource.</span></span> <span data-ttu-id="89b5a-230">위의 태그에서 `<location>` 요소는 `CreatingUserAccounts.aspx` 페이지를 참조 하 고 Tito를 허용 하 고 다른 모든 사용자를 거부 하는 등의 권한 부여 규칙을 지정 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-230">In the above markup the `<location>` element references the `CreatingUserAccounts.aspx` page and specifies its authorization rules such as to allow Tito, but deny everyone else.</span></span>

<span data-ttu-id="89b5a-231">이 권한 부여 변경을 테스트 하려면 먼저 익명 사용자로 웹 사이트를 방문 하세요.</span><span class="sxs-lookup"><span data-stu-id="89b5a-231">To test out this authorization change, start by visiting the website as an anonymous user.</span></span> <span data-ttu-id="89b5a-232">`UserBasedAuthorization.aspx`와 같이 `Membership` 폴더의 모든 페이지를 방문 하려고 하면 `UrlAuthorizationModule` 요청을 거부 하 고 로그인 페이지로 리디렉션됩니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-232">If you attempt to visit any page in the `Membership` folder, such as `UserBasedAuthorization.aspx`, the `UrlAuthorizationModule` will deny the request and you will be redirected to the login page.</span></span> <span data-ttu-id="89b5a-233">로 로그인 한 후에는 `CreatingUserAccounts.aspx`를 *제외 하* 고 `Membership` 폴더의 모든 페이지를 방문할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-233">After logging in as, say, Scott, you can visit any page in the `Membership` folder *except* for `CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="89b5a-234">사용자로 로그온 한 `CreatingUserAccounts.aspx` 방문 하려고 시도 하면 무단 액세스 시도로 인해 로그인 페이지로 다시 리디렉션됩니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-234">Attempting to visit `CreatingUserAccounts.aspx` logged on as anyone but Tito will result in an unauthorized access attempt, redirecting you back to the login page.</span></span>

> [!NOTE]
> <span data-ttu-id="89b5a-235">`<location>` 요소는 구성의 `<system.web>` 요소 외부에 표시 되어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-235">The `<location>` element must appear outside of the configuration's `<system.web>` element.</span></span> <span data-ttu-id="89b5a-236">재정의 하려는 권한 부여 설정이 포함 된 각 리소스에 대해 별도의 `<location>` 요소를 사용 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-236">You need to use a separate `<location>` element for each resource whose authorization settings you want to override.</span></span>

### <a name="a-look-at-how-theurlauthorizationmoduleuses-the-authorization-rules-to-grant-or-deny-access"></a><span data-ttu-id="89b5a-237">`UrlAuthorizationModule`권한 부여 규칙을 사용 하 여 액세스 권한을 부여 하거나 거부 하는 방법에 대해 살펴봅니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-237">A Look at How the`UrlAuthorizationModule`Uses the Authorization Rules to Grant or Deny Access</span></span>

<span data-ttu-id="89b5a-238">`UrlAuthorizationModule`은 한 번에 하나씩 URL 권한 부여 규칙을 분석 하 여 특정 URL에 대 한 특정 id에 대 한 권한을 부여할 것인지 여부를 결정 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-238">The `UrlAuthorizationModule` determines whether to authorize a particular identity for a particular URL by analyzing the URL authorization rules one at a time, starting from the first one and working its way down.</span></span> <span data-ttu-id="89b5a-239">일치 항목이 발견 되는 즉시 사용자에 게 일치 항목을 `<allow>` 또는 `<deny>` 요소에서 찾을 수 있는지에 따라 액세스 권한이 부여 되거나 거부 됩니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-239">As soon as a match is found, the user is granted or denied access, depending on if the match was found in an `<allow>` or `<deny>` element.</span></span> <span data-ttu-id="89b5a-240"><strong>일치 항목을 찾을 수 없는 경우 사용자에 게 액세스 권한이 부여 됩니다.</strong></span><span class="sxs-lookup"><span data-stu-id="89b5a-240"><strong>If no match is found, the user is granted access.</strong></span></span> <span data-ttu-id="89b5a-241">따라서 액세스를 제한 하려는 경우에는 URL 권한 부여 구성에서 `<deny>` 요소를 마지막 요소로 사용 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-241">Consequently, if you want to restrict access, it is imperative that you use a `<deny>` element as the last element in the URL authorization configuration.</span></span> <span data-ttu-id="89b5a-242"><strong>`<deny>`</strong>요소를 생략 하면 <strong>모든 사용자에 게 액세스 권한이 부여 됩니다.</strong></span><span class="sxs-lookup"><span data-stu-id="89b5a-242"><strong>If you omit a</strong><strong>`<deny>`</strong><strong>element, all users will be granted access.</strong></span></span>

<span data-ttu-id="89b5a-243">`UrlAuthorizationModule`에서 권한을 확인 하는 데 사용 하는 프로세스를 보다 잘 이해 하려면이 단계 앞부분에서 살펴본 URL 권한 부여 규칙 예제를 참조 하십시오.</span><span class="sxs-lookup"><span data-stu-id="89b5a-243">To better understand the process used by the `UrlAuthorizationModule` to determine authority, consider the example URL authorization rules we looked at earlier in this step.</span></span> <span data-ttu-id="89b5a-244">첫 번째 규칙은 Tito와 Scott에 게 액세스를 허용 하는 `<allow>` 요소입니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-244">The first rule is an `<allow>` element that allows access to Tito and Scott.</span></span> <span data-ttu-id="89b5a-245">두 번째 규칙은 모든 사용자에 대 한 액세스를 거부 하는 `<deny>` 요소입니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-245">The second rules is a `<deny>` element that denies access to everyone.</span></span> <span data-ttu-id="89b5a-246">익명 사용자가 방문 하는 경우 `UrlAuthorizationModule`는 Scott 또는 Tito를 요청 하 여 시작 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-246">If an anonymous user visits, the `UrlAuthorizationModule` starts by asking, Is anonymous either Scott or Tito?</span></span> <span data-ttu-id="89b5a-247">분명히 대답은 아니요 이므로 두 번째 규칙으로 진행 됩니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-247">The answer, obviously, is No, so it proceeds to the second rule.</span></span> <span data-ttu-id="89b5a-248">모든 사람 집합에 익명이 있나요?</span><span class="sxs-lookup"><span data-stu-id="89b5a-248">Is anonymous in the set of everybody?</span></span> <span data-ttu-id="89b5a-249">여기에서 답은 예 이므로 `<deny>` 규칙이 적용 되 고 방문자가 로그인 페이지로 리디렉션됩니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-249">Since the answer here is Yes, the `<deny>` rule is put in effect and the visitor is redirected to the login page.</span></span> <span data-ttu-id="89b5a-250">마찬가지로 Jisun이 방문 하는 경우에는 `UrlAuthorizationModule`에서 시작 하 여 Scott 또는 Tito를 요청 하 여 시작 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-250">Similarly, if Jisun is visiting, the `UrlAuthorizationModule` starts by asking, Is Jisun either Scott or Tito?</span></span> <span data-ttu-id="89b5a-251">이는 그렇지 않기 때문에 두 번째 질문으로 진행 되 고, 모든 사람 집합에서 Jisun이 `UrlAuthorizationModule`?</span><span class="sxs-lookup"><span data-stu-id="89b5a-251">Since she is not, the `UrlAuthorizationModule` proceeds to the second question, Is Jisun in the set of everybody?</span></span> <span data-ttu-id="89b5a-252">그는 그에 대 한 액세스가 거부 되었습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-252">She is, so she, too, is denied access.</span></span> <span data-ttu-id="89b5a-253">마지막으로,이를 방문 하는 경우 `UrlAuthorizationModule`에 의해 제기 되는 첫 번째 질문은 찬성 대답 이므로 Tito에는 액세스 권한이 부여 됩니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-253">Finally, if Tito visits, the first question posed by the `UrlAuthorizationModule` is an affirmative answer, so Tito is granted access.</span></span>

<span data-ttu-id="89b5a-254">`UrlAuthorizationModule`은 위에서 아래로 권한 부여 규칙을 처리 하 여 모든 일치 항목에서 중지 하므로 보다 구체적인 규칙을 보다 구체적인 규칙 보다 먼저 배치 하는 것이 중요 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-254">Since the `UrlAuthorizationModule` processes the authorization rules from the top down, stopping at any match, it is important to have the more specific rules come before the less specific ones.</span></span> <span data-ttu-id="89b5a-255">즉, Jisun 및 익명 사용자를 금지 하 고 다른 모든 인증 된 사용자를 허용 하는 권한 부여 규칙을 정의 하기 위해 가장 구체적인 규칙 (Jisun에 영향을 주는 규칙)부터 시작 하 여 더 낮은 특정 규칙 (다른 모든 것을 허용 하는 규칙)으로 시작 합니다. 인증 된 사용자 이지만 모든 익명 사용자를 거부 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-255">That is, to define authorization rules that forbid Jisun and anonymous users, but allow all other authenticated users, you would start with the most specific rule - the one impacting Jisun - and then proceed to the less specific rules - those allowing all other authenticated users, but denying all anonymous users.</span></span> <span data-ttu-id="89b5a-256">다음 URL 권한 부여 규칙은 먼저 Jisun을 거부 하 고 익명 사용자를 거부 하 여이 정책을 구현 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-256">The following URL authorization rules implements this policy by first denying Jisun, and then denying any anonymous user.</span></span> <span data-ttu-id="89b5a-257">이러한 `<deny>` 문이 모두 일치 하지 않기 때문에 Jisun 이외의 모든 인증 된 사용자에 게 액세스 권한이 부여 됩니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-257">Any authenticated user other than Jisun will be granted access because neither of these `<deny>` statements will match.</span></span>

[!code-xml[Main](user-based-authorization-vb/samples/sample6.xml)]

## <a name="step-2-fixing-the-workflow-for-unauthorized-authenticated-users"></a><span data-ttu-id="89b5a-258">2 단계: 승인 되지 않은 인증 된 사용자에 대 한 워크플로 수정</span><span class="sxs-lookup"><span data-stu-id="89b5a-258">Step 2: Fixing the Workflow for Unauthorized, Authenticated Users</span></span>

<span data-ttu-id="89b5a-259">이 자습서의 앞부분에서 설명한 대로 URL 권한 부여 워크플로 살펴보기 섹션에서 transpires 권한이 없는 요청이 발생 하면 `UrlAuthorizationModule` 요청을 중단 하 고 HTTP 401 권한 없음 상태를 반환 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-259">As we discussed earlier in this tutorial in the A Look at the URL Authorization Workflow section, anytime an unauthorized request transpires, the `UrlAuthorizationModule` aborts the request and returns an HTTP 401 Unauthorized status.</span></span> <span data-ttu-id="89b5a-260">이 401 상태는 `FormsAuthenticationModule`에서 사용자를 로그인 페이지로 보내는 302 리디렉션 상태로 수정 됩니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-260">This 401 status is modified by the `FormsAuthenticationModule` into a 302 Redirect status that sends the user to the login page.</span></span> <span data-ttu-id="89b5a-261">이 워크플로는 사용자가 인증 된 경우에도 모든 권한이 없는 요청에서 발생 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-261">This workflow occurs on any unauthorized request, even if the user is authenticated.</span></span>

<span data-ttu-id="89b5a-262">인증 된 사용자를 로그인 페이지에 반환 하는 것은 시스템에 이미 로그인 했으므로 혼동 될 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-262">Returning an authenticated user to the login page is likely to confuse them since they have already logged into the system.</span></span> <span data-ttu-id="89b5a-263">약간의 작업을 통해 제한 된 페이지에 액세스를 시도 하는 것을 설명 하는 페이지에 대 한 권한이 없는 요청을 하는 인증 된 사용자를 리디렉션하여이 워크플로를 개선할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-263">With a little bit of work we can improve this workflow by redirecting authenticated users who make unauthorized requests to a page that explains that they have attempted to access a restricted page.</span></span>

<span data-ttu-id="89b5a-264">`UnauthorizedAccess.aspx`이라는 웹 응용 프로그램의 루트 폴더에 새 ASP.NET 페이지를 만들어 시작 합니다. 이 페이지를 `Site.master` 마스터 페이지와 연결 하는 것을 잊지 마세요.</span><span class="sxs-lookup"><span data-stu-id="89b5a-264">Start by creating a new ASP.NET page in the web application's root folder named `UnauthorizedAccess.aspx`; don't forget to associate this page with the `Site.master` master page.</span></span> <span data-ttu-id="89b5a-265">이 페이지를 만든 후에는 마스터 페이지의 기본 콘텐츠가 표시 되도록 `LoginContent` ContentPlaceHolder를 참조 하는 콘텐츠 컨트롤을 제거 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-265">After creating this page, remove the Content control that references the `LoginContent` ContentPlaceHolder so that the master page's default content will be displayed.</span></span> <span data-ttu-id="89b5a-266">다음으로, 사용자가 보호 된 리소스에 액세스 하려고 시도 하는 상황을 설명 하는 메시지를 추가 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-266">Next, add a message that explains the situation, namely that the user attempted to access a protected resource.</span></span> <span data-ttu-id="89b5a-267">이러한 메시지를 추가한 후에는 `UnauthorizedAccess.aspx` 페이지의 선언적 태그가 다음과 같이 표시 됩니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-267">After adding such a message, the `UnauthorizedAccess.aspx` page's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](user-based-authorization-vb/samples/sample7.aspx)]

<span data-ttu-id="89b5a-268">이제 인증 된 사용자가 무단 요청을 수행할 경우 로그인 페이지 대신 `UnauthorizedAccess.aspx` 페이지로 전송 되도록 워크플로를 변경 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-268">We now need to alter the workflow so that if an unauthorized request is performed by an authenticated user they are sent to the `UnauthorizedAccess.aspx` page instead of the login page.</span></span> <span data-ttu-id="89b5a-269">로그인 페이지에 대 한 권한이 없는 요청을 리디렉션하는 논리는 `FormsAuthenticationModule` 클래스의 private 메서드 내에 있으므로이 동작을 사용자 지정할 수 없습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-269">The logic that redirects unauthorized requests to the login page is buried within a private method of the `FormsAuthenticationModule` class, so we cannot customize this behavior.</span></span> <span data-ttu-id="89b5a-270">그러나 필요한 경우 사용자를 `UnauthorizedAccess.aspx`로 리디렉션하는 사용자 고유의 논리를 로그인 페이지에 추가 하는 것도 가능 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-270">What we can do, however, is add our own logic to the login page that redirects the user to `UnauthorizedAccess.aspx`, if needed.</span></span>

<span data-ttu-id="89b5a-271">`FormsAuthenticationModule`는 권한이 없는 방문자를 로그인 페이지로 리디렉션하는 경우에는 이름이 `ReturnUrl`인 querystring에 요청 된 권한 없는 URL을 추가 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-271">When the `FormsAuthenticationModule` redirects an unauthorized visitor to the login page it appends the requested, unauthorized URL to the querystring with the name `ReturnUrl`.</span></span> <span data-ttu-id="89b5a-272">예를 들어 인증 되지 않은 사용자가 `OnlyTito.aspx`를 방문 하려고 하면 `FormsAuthenticationModule` `Login.aspx?ReturnUrl=OnlyTito.aspx`으로 리디렉션됩니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-272">For example, if an unauthorized user attempted to visit `OnlyTito.aspx`, the `FormsAuthenticationModule` would redirect them to `Login.aspx?ReturnUrl=OnlyTito.aspx`.</span></span> <span data-ttu-id="89b5a-273">따라서 `ReturnUrl` 매개 변수를 포함 하는 querystring을 가진 인증 된 사용자가 로그인 페이지에 도달 하면이 인증 되지 않은 사용자는 볼 수 있는 권한이 없는 페이지를 방문 하려고 시도 했음을 알 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-273">Therefore, if the login page is reached by an authenticated user with a querystring that includes the `ReturnUrl` parameter, then we know that this unauthenticated user just attempted to visit a page she is not authorized to view.</span></span> <span data-ttu-id="89b5a-274">이 경우 `UnauthorizedAccess.aspx`로 리디렉션하려고 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-274">In such a case, we want to redirect her to `UnauthorizedAccess.aspx`.</span></span>

<span data-ttu-id="89b5a-275">이 작업을 수행 하려면 로그인 페이지의 `Page_Load` 이벤트 처리기에 다음 코드를 추가 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-275">To accomplish this, add the following code to the login page's `Page_Load` event handler:</span></span>

[!code-vb[Main](user-based-authorization-vb/samples/sample8.vb)]

<span data-ttu-id="89b5a-276">위의 코드는 인증 된 권한 없는 사용자를 `UnauthorizedAccess.aspx` 페이지로 리디렉션합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-276">The above code redirects authenticated, unauthorized users to the `UnauthorizedAccess.aspx` page.</span></span> <span data-ttu-id="89b5a-277">이 논리를 작동 하는 것을 보려면 익명 방문자로 사이트를 방문 하 고 왼쪽 열에서 사용자 계정 만들기 링크를 클릭 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-277">To see this logic in action, visit the site as an anonymous visitor and click on the Creating User Accounts link in the left column.</span></span> <span data-ttu-id="89b5a-278">이렇게 하면 1 단계에서 Tito에 대 한 액세스만 허용 하도록 구성 된 `~/Membership/CreatingUserAccounts.aspx` 페이지로 이동 됩니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-278">This will take you to the `~/Membership/CreatingUserAccounts.aspx` page, which in Step 1 we configured to only permit access to Tito.</span></span> <span data-ttu-id="89b5a-279">익명 사용자는 금지 되어 있으므로 `FormsAuthenticationModule` 로그인 페이지로 다시 리디렉션됩니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-279">Since anonymous users are prohibited, the `FormsAuthenticationModule` redirects us back to the login page.</span></span>

<span data-ttu-id="89b5a-280">이 시점에서 익명 이므로 `Request.IsAuthenticated` `False`를 반환 하 고 `UnauthorizedAccess.aspx`으로 리디렉션되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-280">At this point we are anonymous, so `Request.IsAuthenticated` returns `False` and we are not redirected to `UnauthorizedAccess.aspx`.</span></span> <span data-ttu-id="89b5a-281">대신 로그인 페이지가 표시 됩니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-281">Instead, the login page is displayed.</span></span> <span data-ttu-id="89b5a-282">Bruce와 같이 Tito 이외의 사용자로 로그인 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-282">Log in as a user other than Tito, such as Bruce.</span></span> <span data-ttu-id="89b5a-283">적절 한 자격 증명을 입력 한 후에는 로그인 페이지를 다시 `~/Membership/CreatingUserAccounts.aspx`으로 리디렉션합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-283">After entering the appropriate credentials, the login page redirects us back to `~/Membership/CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="89b5a-284">그러나이 페이지는 Tito 에서만 액세스할 수 있으므로이 페이지를 볼 수 없으며 로그인 페이지로 즉시 반환 됩니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-284">However, since this page is only accessible to Tito, we are unauthorized to view it and are promptly returned to the login page.</span></span> <span data-ttu-id="89b5a-285">그러나 이번에는 `Request.IsAuthenticated` `True` (`ReturnUrl` 및 querystring 매개 변수가 존재 함)를 반환 하므로 `UnauthorizedAccess.aspx` 페이지로 리디렉션됩니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-285">This time, however, `Request.IsAuthenticated` returns `True` (and the `ReturnUrl` querystring parameter exists), so we are redirected to the `UnauthorizedAccess.aspx` page.</span></span>

<span data-ttu-id="89b5a-286">[인증 ![권한이 없는 사용자는 UnauthorizedAccess로 리디렉션됩니다.](user-based-authorization-vb/_static/image17.png)](user-based-authorization-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="89b5a-286">[![Authenticated, Unauthorized Users are Redirected to UnauthorizedAccess.aspx](user-based-authorization-vb/_static/image17.png)](user-based-authorization-vb/_static/image16.png)</span></span>

<span data-ttu-id="89b5a-287">**그림 6**: 인증 됨, 권한이 없는 사용자가 `UnauthorizedAccess.aspx`로 리디렉션 ([전체 크기 이미지를 보려면 클릭](user-based-authorization-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="89b5a-287">**Figure 6**: Authenticated, Unauthorized Users are Redirected to `UnauthorizedAccess.aspx` ([Click to view full-size image](user-based-authorization-vb/_static/image18.png))</span></span>

<span data-ttu-id="89b5a-288">이 사용자 지정 된 워크플로는 그림 2에 나와 있는 주기를 짧게 하 여 보다 합리적이 고 간단한 사용자 환경을 제공 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-288">This customized workflow presents a more sensible and straightforward user experience by short circuiting the cycle depicted in Figure 2.</span></span>

## <a name="step-3-limiting-functionality-based-on-the-currently-logged-in-user"></a><span data-ttu-id="89b5a-289">3 단계: 현재 로그인 한 사용자에 따라 기능 제한</span><span class="sxs-lookup"><span data-stu-id="89b5a-289">Step 3: Limiting Functionality Based on the Currently Logged In User</span></span>

<span data-ttu-id="89b5a-290">URL 권한 부여를 사용 하면 정교 하지 않은 권한 부여 규칙을 쉽게 지정할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-290">URL authorization makes it easy to specify coarse authorization rules.</span></span> <span data-ttu-id="89b5a-291">1 단계에서 살펴본 것 처럼 URL 권한 부여를 사용 하면 허용 되는 id와 특정 페이지 또는 폴더의 모든 페이지를 볼 수 없도록 거부 된 id를 간략하게 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-291">As we saw in Step 1, with URL authorization we can succinctly state what identities are permitted and which ones are denied from viewing a particular page or all pages in a folder.</span></span> <span data-ttu-id="89b5a-292">그러나 특정 시나리오에서는 모든 사용자가 페이지를 방문 하도록 허용할 수 있지만 해당 페이지를 방문 하는 사용자에 따라 페이지의 기능을 제한할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-292">In certain scenarios, however, we may want to allow all users to visit a page, but limit the page's functionality based on the user visiting it.</span></span>

<span data-ttu-id="89b5a-293">인증 된 방문자가 제품을 검토할 수 있도록 하는 전자 상거래 웹 사이트의 경우를 고려 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-293">Consider the case of an eCommerce website that allows authenticated visitors to review their products.</span></span> <span data-ttu-id="89b5a-294">익명 사용자가 제품의 페이지를 방문 하면 제품 정보만 표시 되 고 검토를 남길 기회가 제공 되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-294">When an anonymous user visits a product's page, they would see just the product information and would not be given the opportunity to leave a review.</span></span> <span data-ttu-id="89b5a-295">그러나 동일한 페이지를 방문 하는 인증 된 사용자는 검토 인터페이스를 볼 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-295">However, an authenticated user visiting the same page would see the reviewing interface.</span></span> <span data-ttu-id="89b5a-296">인증 된 사용자가이 제품을 아직 검토 하지 않은 경우 인터페이스를 사용 하 여 검토를 제출할 수 있습니다. 그렇지 않으면 이전에 제출 된 검토를 표시 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-296">If the authenticated user had not yet reviewed this product, the interface would enable them to submit a review; otherwise it would show them their previously-submitted review.</span></span> <span data-ttu-id="89b5a-297">이 시나리오에 대 한 단계를 수행 하기 위해 제품 페이지에 추가 정보가 표시 되 고 전자 상거래 회사에서 작업 하는 사용자에 게 확장 기능이 제공 될 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-297">To take this scenario a step further, the product page might show additional information and offer extended features for those users that work for the eCommerce company.</span></span> <span data-ttu-id="89b5a-298">예를 들어 제품 페이지에서 재고를 재고 목록으로 나열 하 고 직원 들이 방문할 때 제품의 가격과 설명을 편집 하는 옵션을 포함할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-298">For example, the product page might list the inventory in stock and include options to edit the product's price and description when visited by an employee.</span></span>

<span data-ttu-id="89b5a-299">이러한 미세 수준 권한 부여 규칙은 선언적으로 또는 프로그래밍 방식으로 구현 하거나 둘 중 일부를 조합 하 여 구현할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-299">Such fine grain authorization rules can be implemented either declaratively or programmatically (or through some combination of the two).</span></span> <span data-ttu-id="89b5a-300">다음 섹션에서는 LoginView 컨트롤을 통해 미세 인증을 구현 하는 방법을 알아봅니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-300">In the next section we will see how to implement fine grain authorization via the LoginView control.</span></span> <span data-ttu-id="89b5a-301">다음에는 프로그래밍 방식으로 살펴볼 것입니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-301">Following that, we will explore programmatic techniques.</span></span> <span data-ttu-id="89b5a-302">그러나 세분화 된 권한 부여 규칙을 적용 하는 방법에 대 한 자세한 내용은 먼저 해당 기능이 있는 사용자에 따라 달라 지는 페이지를 만들어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-302">Before we can look at applying fine grain authorization rules, however, we first need to create a page whose functionality depends on the user visiting it.</span></span>

<span data-ttu-id="89b5a-303">GridView 내의 특정 디렉터리에 있는 파일을 나열 하는 페이지를 만들어 보겠습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-303">Let's create a page that lists the files in a particular directory within a GridView.</span></span> <span data-ttu-id="89b5a-304">GridView에는 각 파일의 이름, 크기 및 기타 정보를 나열 하는 것과 함께 Linkbutton의 두 열이 포함 됩니다. 하나는 뷰이 고 하나는 Delete입니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-304">Along with listing each file's name, size, and other information, the GridView will include two columns of LinkButtons: one titled View and one titled Delete.</span></span> <span data-ttu-id="89b5a-305">LinkButton 보기를 클릭 하면 선택한 파일의 내용이 표시 됩니다. Delete LinkButton를 클릭 하면 파일이 삭제 됩니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-305">If the View LinkButton is clicked, the contents of the selected file will be displayed; if the Delete LinkButton is clicked, the file will be deleted.</span></span> <span data-ttu-id="89b5a-306">처음에는 모든 사용자가 해당 보기 및 삭제 기능을 사용할 수 있도록이 페이지를 만들어 보겠습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-306">Let's initially create this page such that its view and delete functionality is available to all users.</span></span> <span data-ttu-id="89b5a-307">LoginView 컨트롤을 사용 하 고 프로그래밍 방식으로 기능을 제한 섹션에서는 페이지를 방문 하는 사용자에 따라 이러한 기능을 사용 하거나 사용 하지 않도록 설정 하는 방법을 알아봅니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-307">In the Using the LoginView Control and Programmatically Limiting Functionality sections we will see how to enable or disable these features based on the user visiting the page.</span></span>

> [!NOTE]
> <span data-ttu-id="89b5a-308">빌드 하려는 ASP.NET 페이지에서 GridView 컨트롤을 사용 하 여 파일 목록을 표시 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-308">The ASP.NET page we are about to build uses a GridView control to display a list of files.</span></span> <span data-ttu-id="89b5a-309">이 자습서 시리즈는 폼 인증, 권한 부여, 사용자 계정 및 역할에 중점을 둘 수 있으므로 GridView 컨트롤의 내부 작업에 대해 너무 많은 시간을 할애 하지 않으려고 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-309">Since this tutorial series focuses on forms authentication, authorization, user accounts, and roles, I do not want to spend too much time discussing the inner workings of the GridView control.</span></span> <span data-ttu-id="89b5a-310">이 자습서에서는이 페이지를 설정 하는 방법에 대 한 구체적인 단계별 지침을 제공 하지만 특정 항목을 선택 하는 이유와 렌더링 된 출력에 적용 되는 특정 속성에 대 한 자세한 내용은 설명 하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-310">While this tutorial provides specific step-by-step instructions for setting up this page, it does not delve into the details of why certain choices were made, or what effect particular properties have on the rendered output.</span></span> <span data-ttu-id="89b5a-311">GridView 컨트롤을 철저 하 게 검사 하려면 *[ASP.NET 2.0 자습서 시리즈의 데이터로 작업](../../data-access/index.md)* 을 참조 하세요.</span><span class="sxs-lookup"><span data-stu-id="89b5a-311">For a thorough examination of the GridView control, consult my *[Working with Data in ASP.NET 2.0](../../data-access/index.md)* tutorial series.</span></span>

<span data-ttu-id="89b5a-312">먼저 `Membership` 폴더에서 `UserBasedAuthorization.aspx` 파일을 열고 `FilesGrid`라는 페이지에 GridView 컨트롤을 추가 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-312">Start by opening the `UserBasedAuthorization.aspx` file in the `Membership` folder and adding a GridView control to the page named `FilesGrid`.</span></span> <span data-ttu-id="89b5a-313">GridView의 스마트 태그에서 열 편집 링크를 클릭 하 여 필드 대화 상자를 시작 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-313">From the GridView's Smart Tag, click the Edit Columns link to launch the Fields dialog box.</span></span> <span data-ttu-id="89b5a-314">여기에서 왼쪽 아래 모서리에 있는 필드 자동 생성 확인란의 선택을 취소 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-314">From here, uncheck the Auto-generate fields checkbox in the lower left corner.</span></span> <span data-ttu-id="89b5a-315">그런 다음 왼쪽 위 모서리에서 선택 단추, 삭제 단추 및 두 개의 BoundFields를 추가 합니다 (선택 및 삭제 단추는 CommandField type 아래에 있음).</span><span class="sxs-lookup"><span data-stu-id="89b5a-315">Next, add a Select button, a Delete button, and two BoundFields from the upper left corner (the Select and Delete buttons can be found under the CommandField type).</span></span> <span data-ttu-id="89b5a-316">선택 단추의 `SelectText` 속성을 View로 설정 하 고, 첫 번째 BoundField의 `HeaderText` 및 `DataField` 속성을 Name으로 설정 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-316">Set the Select button's `SelectText` property to View and the first BoundField's `HeaderText` and `DataField` properties to Name.</span></span> <span data-ttu-id="89b5a-317">두 번째 BoundField의 `HeaderText` 속성을 크기 (바이트)로 설정 하 고 `DataField` 속성을 Length로 설정 하 고 `DataFormatString` 속성을 {0:N0}로 설정 하 고 해당 `HtmlEncode` 속성을 False로 설정 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-317">Set the second BoundField's `HeaderText` property to Size in Bytes, its `DataField` property to Length, its `DataFormatString` property to {0:N0} and its `HtmlEncode` property to False.</span></span>

<span data-ttu-id="89b5a-318">GridView의 열을 구성한 후 확인을 클릭 하 여 필드 대화 상자를 닫습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-318">After configuring the GridView's columns, click OK to close the Fields dialog box.</span></span> <span data-ttu-id="89b5a-319">속성 창에서 GridView의 `DataKeyNames` 속성을 `FullName`로 설정 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-319">From the Properties window, set the GridView's `DataKeyNames` property to `FullName`.</span></span> <span data-ttu-id="89b5a-320">이 시점에서 GridView의 선언 태그는 다음과 같습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-320">At this point the GridView's declarative markup should look like the following:</span></span>

[!code-aspx[Main](user-based-authorization-vb/samples/sample9.aspx)]

<span data-ttu-id="89b5a-321">GridView의 태그가 만들어지면 특정 디렉터리에 있는 파일을 검색 하 고 GridView에 바인딩하는 코드를 작성할 준비가 되었습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-321">With the GridView's markup created, we're ready to write the code that will retrieve the files in a particular directory and bind them to the GridView.</span></span> <span data-ttu-id="89b5a-322">페이지의 `Page_Load` 이벤트 처리기에 다음 코드를 추가 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-322">Add the following code to the page's `Page_Load` event handler:</span></span>

[!code-vb[Main](user-based-authorization-vb/samples/sample10.vb)]

<span data-ttu-id="89b5a-323">위의 코드는 [`DirectoryInfo` 클래스](https://msdn.microsoft.com/library/system.io.directoryinfo.aspx) 를 사용 하 여 응용 프로그램의 루트 폴더에 있는 파일 목록을 가져옵니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-323">The above code uses the [`DirectoryInfo` class](https://msdn.microsoft.com/library/system.io.directoryinfo.aspx) to obtain a list of the files in the application's root folder.</span></span> <span data-ttu-id="89b5a-324">[`GetFiles()` 메서드](https://msdn.microsoft.com/library/system.io.directoryinfo.getfiles.aspx) 는 디렉터리의 모든 파일을 [`FileInfo` 개체](https://msdn.microsoft.com/library/system.io.fileinfo.aspx)배열로 반환 합니다. 그러면이 파일은 GridView에 바인딩됩니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-324">The [`GetFiles()` method](https://msdn.microsoft.com/library/system.io.directoryinfo.getfiles.aspx) returns all of the files in the directory as an array of [`FileInfo` objects](https://msdn.microsoft.com/library/system.io.fileinfo.aspx), which is then bound to the GridView.</span></span> <span data-ttu-id="89b5a-325">`FileInfo` 개체에는 `Name`, `Length`, `IsReadOnly`등 다른 속성 모음이 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-325">The `FileInfo` object has an assortment of properties, such as `Name`, `Length`, and `IsReadOnly`, among others.</span></span> <span data-ttu-id="89b5a-326">선언 태그에서 볼 수 있듯이 GridView는 `Name` 및 `Length` 속성만 표시 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-326">As you can see from its declarative markup, the GridView displays just the `Name` and `Length` properties.</span></span>

> [!NOTE]
> <span data-ttu-id="89b5a-327">`DirectoryInfo` 및 `FileInfo` 클래스는 [`System.IO` 네임 스페이스](https://msdn.microsoft.com/library/system.io.aspx)에 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-327">The `DirectoryInfo` and `FileInfo` classes are found in the [`System.IO` namespace](https://msdn.microsoft.com/library/system.io.aspx).</span></span> <span data-ttu-id="89b5a-328">따라서 이러한 클래스 이름 앞에 네임 스페이스 이름을 사용 하거나 네임 스페이스를 클래스 파일 (`Imports System.IO`을 통해)로 가져와야 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-328">Therefore, you will either need to preface these class names with their namespace names or have the namespace imported into the class file (via `Imports System.IO`).</span></span>

<span data-ttu-id="89b5a-329">잠시 시간을 내 서 브라우저를 통해이 페이지를 방문 하세요.</span><span class="sxs-lookup"><span data-stu-id="89b5a-329">Take a moment to visit this page through a browser.</span></span> <span data-ttu-id="89b5a-330">응용 프로그램의 루트 디렉터리에 있는 파일의 목록이 표시 됩니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-330">It will display the list of files residing in the application's root directory.</span></span> <span data-ttu-id="89b5a-331">뷰를 클릭 하거나 Linkbutton을 삭제 하면 다시 게시가 발생 하지만 필요한 이벤트 처리기를 아직 만들지 않았기 때문에 아무 동작도 발생 하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-331">Clicking any of the View or Delete LinkButtons will cause a postback, but no action will occur because we've yet to create the necessary event handlers.</span></span>

<span data-ttu-id="89b5a-332">[![GridView에서 웹 응용 프로그램의 루트 디렉터리에 있는 파일을 나열 합니다.](user-based-authorization-vb/_static/image20.png)](user-based-authorization-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="89b5a-332">[![The GridView Lists the Files in the Web Application's Root Directory](user-based-authorization-vb/_static/image20.png)](user-based-authorization-vb/_static/image19.png)</span></span>

<span data-ttu-id="89b5a-333">**그림 7**: GridView는 웹 응용 프로그램의 루트 디렉터리에 있는 파일을 나열 합니다 ([전체 크기 이미지를 보려면 클릭](user-based-authorization-vb/_static/image21.png)).</span><span class="sxs-lookup"><span data-stu-id="89b5a-333">**Figure 7**: The GridView Lists the Files in the Web Application's Root Directory  ([Click to view full-size image](user-based-authorization-vb/_static/image21.png))</span></span>

<span data-ttu-id="89b5a-334">선택한 파일의 콘텐츠를 표시 하는 방법이 필요 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-334">We need a means to display the contents of the selected file.</span></span> <span data-ttu-id="89b5a-335">Visual Studio로 돌아가서 GridView 위에 `FileContents` 이라는 텍스트 상자를 추가 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-335">Return to Visual Studio and add a TextBox named `FileContents` above the GridView.</span></span> <span data-ttu-id="89b5a-336">`TextMode` 속성을 `MultiLine`로 설정 하 고 해당 `Columns` 및 `Rows` 속성을 각각 95% 및 10으로 설정 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-336">Set its `TextMode` property to `MultiLine` and its `Columns` and `Rows` properties to 95% and 10, respectively.</span></span>

[!code-aspx[Main](user-based-authorization-vb/samples/sample11.aspx)]

<span data-ttu-id="89b5a-337">다음으로 GridView의 [`SelectedIndexChanged` 이벤트](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.selectedindexchanged.aspx) 에 대 한 이벤트 처리기를 만들고 다음 코드를 추가 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-337">Next, create an event handler for the GridView's [`SelectedIndexChanged` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.selectedindexchanged.aspx) and add the following code:</span></span>

[!code-vb[Main](user-based-authorization-vb/samples/sample12.vb)]

<span data-ttu-id="89b5a-338">이 코드는 GridView의 `SelectedValue` 속성을 사용 하 여 선택한 파일의 전체 파일 이름을 확인 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-338">This code uses the GridView's `SelectedValue` property to determine the full file name of the selected file.</span></span> <span data-ttu-id="89b5a-339">내부적으로는 `DataKeys` 컬렉션을 참조 하 여 `SelectedValue`를 가져오기 때문에이 단계 앞부분에서 설명한 대로 GridView의 `DataKeyNames` 속성을 Name으로 설정 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-339">Internally, the `DataKeys` collection is referenced in order to obtain the `SelectedValue`, so it is imperative that you set the GridView's `DataKeyNames` property to Name, as described earlier in this step.</span></span> <span data-ttu-id="89b5a-340">[`File` 클래스](https://msdn.microsoft.com/library/system.io.file.aspx) 는 선택한 파일의 내용을 문자열로 읽어 `FileContents` 텍스트 상자의 `Text` 속성에 할당 하 여 페이지에서 선택한 파일의 내용을 표시 하는 데 사용 됩니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-340">The [`File` class](https://msdn.microsoft.com/library/system.io.file.aspx) is used to read the selected file's contents into a string, which is then assigned to the `FileContents` TextBox's `Text` property, thereby displaying the contents of the selected file on the page.</span></span>

<span data-ttu-id="89b5a-341">[선택한 파일의 내용이 텍스트 상자에 표시 ![](user-based-authorization-vb/_static/image23.png)](user-based-authorization-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="89b5a-341">[![The Selected File's Contents are Displayed in the TextBox](user-based-authorization-vb/_static/image23.png)](user-based-authorization-vb/_static/image22.png)</span></span>

<span data-ttu-id="89b5a-342">**그림 8**: 선택한 파일의 내용이 텍스트 상자에 표시 됩니다 ([전체 크기 이미지를 보려면 클릭](user-based-authorization-vb/_static/image24.png)).</span><span class="sxs-lookup"><span data-stu-id="89b5a-342">**Figure 8**: The Selected File's Contents are Displayed in the TextBox  ([Click to view full-size image](user-based-authorization-vb/_static/image24.png))</span></span>

> [!NOTE]
> <span data-ttu-id="89b5a-343">HTML 태그를 포함 하는 파일의 내용을 확인 한 후 파일을 보거나 삭제 하려고 하면 `HttpRequestValidationException` 오류가 표시 됩니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-343">If you view the contents of a file that contains HTML markup, and then attempt to view or delete a file, you will receive an `HttpRequestValidationException` error.</span></span> <span data-ttu-id="89b5a-344">이는 포스트백 시 텍스트 상자 내용이 웹 서버로 다시 전송 되기 때문에 발생 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-344">This occurs because on postback the TextBox's contents are sent back to the web server.</span></span> <span data-ttu-id="89b5a-345">기본적으로 ASP.NET는 잠재적으로 위험한 포스트백 콘텐츠 (예: HTML 태그)가 검색 될 때마다 `HttpRequestValidationException` 오류를 발생 시킵니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-345">By default, ASP.NET raises an `HttpRequestValidationException` error whenever potentially dangerous postback content, such as HTML markup, is detected.</span></span> <span data-ttu-id="89b5a-346">이 오류가 발생 하지 않도록 하려면 `@Page` 지시문에 `ValidateRequest="false"`를 추가 하 여 페이지에 대 한 요청 유효성 검사를 해제 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-346">To disable this error from occurring, turn off request validation for the page by adding `ValidateRequest="false"` to the `@Page` directive.</span></span> <span data-ttu-id="89b5a-347">요청 유효성 검사의 이점 및 사용 하지 않도록 설정할 때 수행 해야 하는 예방 조치에 대 한 자세한 내용은 [요청 유효성 검사-스크립트 공격 방지](https://asp.net/learn/whitepapers/request-validation/)를 참조 하세요.</span><span class="sxs-lookup"><span data-stu-id="89b5a-347">For more information on the benefits of request validation as well as what precautions you should take when disabling it, read [Request Validation - Preventing Script Attacks](https://asp.net/learn/whitepapers/request-validation/).</span></span>

<span data-ttu-id="89b5a-348">마지막으로 GridView의 [`RowDeleting` 이벤트](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rowdeleting.aspx)에 대해 다음 코드를 사용 하 여 이벤트 처리기를 추가 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-348">Finally, add an event handler with the following code for the GridView's [`RowDeleting` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rowdeleting.aspx):</span></span>

[!code-vb[Main](user-based-authorization-vb/samples/sample13.vb)]

<span data-ttu-id="89b5a-349">코드는 실제로 파일을 삭제 *하지 않고* `FileContents` 텍스트 상자에서 삭제할 파일의 전체 이름을 표시 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-349">The code simply displays the full name of the file to delete in the `FileContents` TextBox *without* actually deleting the file.</span></span>

<span data-ttu-id="89b5a-350">[삭제 단추를 클릭 하 ![파일을 실제로 삭제 하지는 않습니다.](user-based-authorization-vb/_static/image26.png)](user-based-authorization-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="89b5a-350">[![Clicking the Delete Button Does Not Actually Delete the File](user-based-authorization-vb/_static/image26.png)](user-based-authorization-vb/_static/image25.png)</span></span>

<span data-ttu-id="89b5a-351">**그림 9**: 삭제 단추를 클릭 해도 파일이 실제로 삭제 되지 않음 ([전체 크기 이미지를 보려면 클릭](user-based-authorization-vb/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="89b5a-351">**Figure 9**: Clicking the Delete Button Does Not Actually Delete the File  ([Click to view full-size image](user-based-authorization-vb/_static/image27.png))</span></span>

<span data-ttu-id="89b5a-352">1 단계에서는 익명 사용자가 `Membership` 폴더의 페이지를 볼 수 없도록 URL 권한 부여 규칙을 구성 했습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-352">In Step 1 we configured the URL authorization rules to prohibit anonymous users from viewing the pages in the `Membership` folder.</span></span> <span data-ttu-id="89b5a-353">보다 확실 한 인증을 위해 익명 사용자가 `UserBasedAuthorization.aspx` 페이지를 방문 하 고 제한 된 기능을 사용할 수 있도록 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-353">In order to better exhibit fine grain authentication, let's allow anonymous users to visit the `UserBasedAuthorization.aspx` page, but with limited functionality.</span></span> <span data-ttu-id="89b5a-354">이 페이지를 모든 사용자가 액세스할 수 있는 상태로 열려면 `Membership` 폴더의 `Web.config` 파일에 다음 `<location>` 요소를 추가 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-354">To open this page up to be accessed by all users, add the following `<location>` element to the `Web.config` file in the `Membership` folder:</span></span>

[!code-xml[Main](user-based-authorization-vb/samples/sample14.xml)]

<span data-ttu-id="89b5a-355">이 `<location>` 요소를 추가한 후에는 사이트에서 로그 아웃 하 여 새 URL 권한 부여 규칙을 테스트 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-355">After adding this `<location>` element, test the new URL authorization rules by logging out of the site.</span></span> <span data-ttu-id="89b5a-356">익명 사용자는 `UserBasedAuthorization.aspx` 페이지를 방문할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-356">As an anonymous user you should be permitted to visit the `UserBasedAuthorization.aspx` page.</span></span>

<span data-ttu-id="89b5a-357">현재는 인증 된 사용자 또는 익명 사용자가 `UserBasedAuthorization.aspx` 페이지를 방문 하 여 파일을 보거나 삭제할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-357">Currently, any authenticated or anonymous user can visit the `UserBasedAuthorization.aspx` page and view or delete files.</span></span> <span data-ttu-id="89b5a-358">즉, 인증 된 사용자만 파일의 콘텐츠를 볼 수 있고 Tito는 파일을 삭제할 수 있게 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-358">Let's make it so that only authenticated users can view contents of a file and only Tito can delete a file.</span></span> <span data-ttu-id="89b5a-359">이러한 미세 수준 권한 부여 규칙은 선언적으로 또는 두 방법의 조합을 통해 적용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-359">Such fine grain authorization rules can be applied declaratively, programmatically, or through a combination of both methods.</span></span> <span data-ttu-id="89b5a-360">선언적 방법을 사용 하 여 파일의 내용을 볼 수 있는 사용자를 제한 하겠습니다. 프로그래밍 방식을 사용 하 여 파일을 삭제할 수 있는 사용자를 제한 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-360">Let's use the declarative approach to limit who can view the contents of a file; we'll use the programmatic approach to limit who can delete a file.</span></span>

### <a name="using-the-loginview-control"></a><span data-ttu-id="89b5a-361">LoginView 컨트롤 사용</span><span class="sxs-lookup"><span data-stu-id="89b5a-361">Using the LoginView Control</span></span>

<span data-ttu-id="89b5a-362">이전 자습서에서 살펴본 것 처럼 LoginView 컨트롤은 인증 된 사용자와 익명 사용자에 대해 서로 다른 인터페이스를 표시 하는 데 유용 하며 익명 사용자가 액세스할 수 없는 기능을 숨기는 간편한 방법을 제공 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-362">As we've seen in past tutorials, the LoginView control is useful for displaying different interfaces for authenticated and anonymous users, and offers an easy way to hide functionality that is not accessible to anonymous users.</span></span> <span data-ttu-id="89b5a-363">익명 사용자는 파일을 보거나 삭제할 수 없으므로 인증 된 사용자가 페이지를 방문 하는 경우에만 `FileContents` 텍스트 상자를 표시 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-363">Since anonymous users cannot view or delete files, we only need to show the `FileContents` TextBox when the page is visited by an authenticated user.</span></span> <span data-ttu-id="89b5a-364">이렇게 하려면 LoginView 컨트롤을 페이지에 추가 하 고 이름을 `LoginViewForFileContentsTextBox`로 `FileContents` 한 다음 텍스트 상자의 선언 태그를 LoginView 컨트롤의 `LoggedInTemplate`로 이동 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-364">To achieve this, add a LoginView control to the page, name it `LoginViewForFileContentsTextBox`, and move the `FileContents` TextBox's declarative markup into the LoginView control's `LoggedInTemplate`.</span></span>

[!code-aspx[Main](user-based-authorization-vb/samples/sample15.aspx)]

<span data-ttu-id="89b5a-365">LoginView의 템플릿에 있는 웹 컨트롤은 더 이상 코드 지향 클래스에서 직접 액세스할 수 없습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-365">The Web controls in the LoginView's templates are no longer directly accessible from the code-behind class.</span></span> <span data-ttu-id="89b5a-366">예를 들어 `FilesGrid` GridView의 `SelectedIndexChanged` 및 `RowDeleting` 이벤트 처리기는 현재 다음과 같은 코드를 사용 하 여 `FileContents` TextBox 컨트롤을 참조 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-366">For example, the `FilesGrid` GridView's `SelectedIndexChanged` and `RowDeleting` event handlers currently reference the `FileContents` TextBox control with code like:</span></span>

[!code-aspx[Main](user-based-authorization-vb/samples/sample16.aspx)]

<span data-ttu-id="89b5a-367">그러나이 코드는 더 이상 유효 하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-367">However, this code is no longer valid.</span></span> <span data-ttu-id="89b5a-368">`FileContents` TextBox를 `LoggedInTemplate`으로 이동 하 여 텍스트 상자를 직접 액세스할 수 없습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-368">By moving the `FileContents` TextBox into the `LoggedInTemplate` the TextBox cannot be directly accessed.</span></span> <span data-ttu-id="89b5a-369">대신 `FindControl("controlId")` 메서드를 사용 하 여 프로그래밍 방식으로 컨트롤을 참조 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-369">Instead, we must use the `FindControl("controlId")` method to programmatically reference the control.</span></span> <span data-ttu-id="89b5a-370">다음과 같이 텍스트 상자를 참조 하도록 `FilesGrid` 이벤트 처리기를 업데이트 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-370">Update the `FilesGrid` event handlers to reference the TextBox like so:</span></span>

[!code-vb[Main](user-based-authorization-vb/samples/sample17.vb)]

<span data-ttu-id="89b5a-371">텍스트 상자를 LoginView의 `LoggedInTemplate`로 이동 하 고 페이지의 코드를 업데이트 하 여 `FindControl("controlId")` 패턴을 사용 하 여 텍스트 상자를 참조 한 후에는 해당 페이지를 익명 사용자로 방문 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-371">After moving the TextBox to the LoginView's `LoggedInTemplate` and updating the page's code to reference the TextBox using the `FindControl("controlId")` pattern, visit the page as an anonymous user.</span></span> <span data-ttu-id="89b5a-372">그림 10에 표시 된 것 처럼 `FileContents` TextBox는 표시 되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-372">As Figure 10 shows, the `FileContents` TextBox is not displayed.</span></span> <span data-ttu-id="89b5a-373">그러나 뷰 LinkButton는 계속 표시 됩니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-373">However, the View LinkButton is still displayed.</span></span>

<span data-ttu-id="89b5a-374">[![LoginView 컨트롤은 인증 된 사용자에 대 한 FileContents TextBox만 렌더링 합니다.](user-based-authorization-vb/_static/image29.png)](user-based-authorization-vb/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="89b5a-374">[![The LoginView Control Only Renders the FileContents TextBox for Authenticated Users](user-based-authorization-vb/_static/image29.png)](user-based-authorization-vb/_static/image28.png)</span></span>

<span data-ttu-id="89b5a-375">**그림 10**: LoginView 컨트롤이 인증 된 사용자에 대 한 `FileContents` TextBox만 렌더링 ([전체 크기 이미지를 보려면 클릭](user-based-authorization-vb/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="89b5a-375">**Figure 10**: The LoginView Control Only Renders the `FileContents` TextBox for Authenticated Users  ([Click to view full-size image](user-based-authorization-vb/_static/image30.png))</span></span>

<span data-ttu-id="89b5a-376">익명 사용자에 대 한 보기 단추를 숨기는 한 가지 방법은 GridView 필드를 Templatefield로 변환 변환 하는 것입니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-376">One way to hide the View button for anonymous users is to convert the GridView field into a TemplateField.</span></span> <span data-ttu-id="89b5a-377">이렇게 하면 LinkButton 뷰의 선언적 태그가 포함 된 템플릿이 생성 됩니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-377">This will generate a template that contains the declarative markup for the View LinkButton.</span></span> <span data-ttu-id="89b5a-378">그런 다음 Templatefield로 변환에 LoginView 컨트롤을 추가 하 고 LinkButton를 LoginView의 `LoggedInTemplate`내에 저장 하 여 익명 방문자의 보기 단추를 숨길 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-378">We can then add a LoginView control to the TemplateField and place the LinkButton within the LoginView's `LoggedInTemplate`, thereby hiding the View button from anonymous visitors.</span></span> <span data-ttu-id="89b5a-379">이를 수행 하려면 GridView의 스마트 태그에서 열 편집 링크를 클릭 하 여 필드 대화 상자를 시작 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-379">To accomplish this, click on the Edit Columns link from the GridView's Smart Tag to launch the Fields dialog box.</span></span> <span data-ttu-id="89b5a-380">그런 다음 왼쪽 아래 모퉁이의 목록에서 선택 단추를 선택 하 고이 필드를 Templatefield로 변환로 변환 링크를 클릭 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-380">Next, select the Select button from the list in the lower left corner and then click the Convert this field to a TemplateField link.</span></span> <span data-ttu-id="89b5a-381">이렇게 하면 필드의 선언적 태그가 다음과 같이 수정 됩니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-381">Doing so will modify the field's declarative markup from:</span></span>

[!code-aspx[Main](user-based-authorization-vb/samples/sample18.aspx)]

 <span data-ttu-id="89b5a-382">아래와 같이 변경합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-382">To:</span></span> 

[!code-aspx[Main](user-based-authorization-vb/samples/sample19.aspx)]

 <span data-ttu-id="89b5a-383">이 시점에서 LoginView을 Templatefield로 변환에 추가할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-383">At this point, we can add a LoginView to the TemplateField.</span></span> <span data-ttu-id="89b5a-384">다음 태그는 인증 된 사용자에 대 한 뷰 LinkButton 표시 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-384">The following markup displays the View LinkButton only for authenticated users.</span></span> 

[!code-aspx[Main](user-based-authorization-vb/samples/sample20.aspx)]

<span data-ttu-id="89b5a-385">그림 11에 표시 된 것 처럼 열 내의 뷰 Linkbutton이 숨겨진 경우에도 결과는 보기 열이 표시 되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-385">As Figure 11 shows, the end result is not that pretty as the View column is still displayed even though the View LinkButtons within the column are hidden.</span></span> <span data-ttu-id="89b5a-386">다음 섹션에서는 LinkButton 뿐 아니라 전체 GridView 열을 숨기는 방법을 살펴보겠습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-386">We will look at how to hide the entire GridView column (and not just the LinkButton) in the next section.</span></span>

<span data-ttu-id="89b5a-387">[LoginView 컨트롤 ![익명 방문자의 Linkbutton 보기를 숨깁니다.](user-based-authorization-vb/_static/image32.png)](user-based-authorization-vb/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="89b5a-387">[![The LoginView Control Hides the View LinkButtons for Anonymous Visitors](user-based-authorization-vb/_static/image32.png)](user-based-authorization-vb/_static/image31.png)</span></span>

<span data-ttu-id="89b5a-388">**그림 11**: LoginView 컨트롤은 익명 방문자에 대 한 뷰 Linkbutton을 숨깁니다 ([전체 크기 이미지를 보려면 클릭](user-based-authorization-vb/_static/image33.png)).</span><span class="sxs-lookup"><span data-stu-id="89b5a-388">**Figure 11**: The LoginView Control Hides the View LinkButtons for Anonymous Visitors  ([Click to view full-size image](user-based-authorization-vb/_static/image33.png))</span></span>

### <a name="programmatically-limiting-functionality"></a><span data-ttu-id="89b5a-389">프로그래밍 방식으로 기능 제한</span><span class="sxs-lookup"><span data-stu-id="89b5a-389">Programmatically Limiting Functionality</span></span>

<span data-ttu-id="89b5a-390">일부 경우에는 기능을 페이지에 제한 하기 위한 선언적 기술이 충분 하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-390">In some circumstances, declarative techniques are insufficient for limiting functionality to a page.</span></span> <span data-ttu-id="89b5a-391">예를 들어 특정 페이지 기능의 가용성은 해당 페이지를 방문 하는 사용자가 익명 인지 아니면 인증 되었는지를 초과 하는 조건에 따라 달라질 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-391">For example, the availability of certain page functionality may be dependent on criteria beyond whether the user visiting the page is anonymous or authenticated.</span></span> <span data-ttu-id="89b5a-392">이러한 경우 다양 한 사용자 인터페이스 요소를 프로그래밍 방식으로 표시 하거나 숨길 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-392">In such cases, the various user interface elements can be displayed or hidden through programmatic means.</span></span>

<span data-ttu-id="89b5a-393">프로그래밍 방식으로 기능을 제한 하려면 다음 두 가지 작업을 수행 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-393">In order to limit the functionality programmatically, we need to perform two tasks:</span></span>

1. <span data-ttu-id="89b5a-394">페이지를 방문 하는 사용자가 해당 기능에 액세스할 수 있는지 여부를 확인 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-394">Determine whether the user visiting the page can access the functionality, and</span></span>
2. <span data-ttu-id="89b5a-395">사용자가 문제의 기능에 액세스할 수 있는지 여부에 따라 프로그래밍 방식으로 사용자 인터페이스를 수정 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-395">Programmatically modify the user interface based on whether the user has access to the functionality in question.</span></span>

<span data-ttu-id="89b5a-396">이러한 두 태스크의 적용을 보여 주기 위해 Tito가 GridView에서 파일을 삭제 하도록 허용 하기만 하면 됩니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-396">To demonstrate the application of these two tasks, let's only allow Tito to delete files from the GridView.</span></span> <span data-ttu-id="89b5a-397">첫 번째 작업은 페이지를 방문 하 고 있는지 여부를 확인 하는 것입니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-397">Our first task, then, is to determine whether it is Tito visiting the page.</span></span> <span data-ttu-id="89b5a-398">이를 확인 한 후 GridView의 Delete 열을 숨기 거 나 표시 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-398">Once that has been determined, we need to hide (or show) the GridView's Delete column.</span></span> <span data-ttu-id="89b5a-399">GridView의 열은 해당 `Columns` 속성을 통해 액세스할 수 있습니다. 열은 `Visible` 속성이 `True` (기본값)로 설정 된 경우에만 렌더링 됩니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-399">The GridView's columns are accessible through its `Columns` property; a column is only rendered if its `Visible` property is set to `True` (the default).</span></span>

<span data-ttu-id="89b5a-400">데이터를 GridView에 바인딩하기 전에 `Page_Load` 이벤트 처리기에 다음 코드를 추가 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-400">Add the following code to the `Page_Load` event handler prior to binding the data to the GridView:</span></span>

[!code-vb[Main](user-based-authorization-vb/samples/sample21.vb)]

<span data-ttu-id="89b5a-401">[*폼 인증 자습서 개요*](../introduction/an-overview-of-forms-authentication-vb.md) 에서 설명한 것 처럼 `User.Identity.Name`는 id의 이름을 반환 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-401">As we discussed in the [*An Overview of Forms Authentication*](../introduction/an-overview-of-forms-authentication-vb.md) tutorial, `User.Identity.Name` returns the identity's name.</span></span> <span data-ttu-id="89b5a-402">이는 로그인 컨트롤에 입력 한 사용자 이름에 해당 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-402">This corresponds to the username entered in the Login control.</span></span> <span data-ttu-id="89b5a-403">페이지를 방문 하는 것 이라면 GridView의 두 번째 열 `Visible` 속성이 `True`로 설정 됩니다. 그렇지 않으면 `False`로 설정 됩니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-403">If it is Tito visiting the page, the GridView's second column's `Visible` property is set to `True`; otherwise, it is set to `False`.</span></span> <span data-ttu-id="89b5a-404">결과적으로 Tito이 아닌 다른 사용자가 인증 된 다른 사용자 또는 익명 사용자로 페이지를 방문 하는 경우 삭제 열은 렌더링 되지 않습니다 (그림 12 참조). 그러나 Tito 페이지를 방문 하는 경우 삭제 열이 있습니다 (그림 13 참조).</span><span class="sxs-lookup"><span data-stu-id="89b5a-404">The net result is that when someone other than Tito visits the page, either another authenticated user or an anonymous user, the Delete column is not rendered (see Figure 12); however, when Tito visits the page, the Delete column is present (see Figure 13).</span></span>

<span data-ttu-id="89b5a-405">[Tito 이외의 다른 사람이 방문 하는 경우 (예: Bruce) 삭제 열이 렌더링 되지 ![](user-based-authorization-vb/_static/image35.png)](user-based-authorization-vb/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="89b5a-405">[![The Delete Column is Not Rendered When Visited By Someone Other Than Tito (Such as Bruce)](user-based-authorization-vb/_static/image35.png)](user-based-authorization-vb/_static/image34.png)</span></span>

<span data-ttu-id="89b5a-406">**그림 12**: Tito (예: bruce)가 아닌 다른 사용자가 방문 하는 경우 삭제 열은 렌더링 되지 않습니다 ([전체 크기 이미지를 보려면 클릭](user-based-authorization-vb/_static/image36.png)).</span><span class="sxs-lookup"><span data-stu-id="89b5a-406">**Figure 12**: The Delete Column is Not Rendered When Visited By Someone Other Than Tito (Such as Bruce)  ([Click to view full-size image](user-based-authorization-vb/_static/image36.png))</span></span>

<span data-ttu-id="89b5a-407">[Tito에 대해 Delete 열이 렌더링 ![](user-based-authorization-vb/_static/image38.png)](user-based-authorization-vb/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="89b5a-407">[![The Delete Column is Rendered for Tito](user-based-authorization-vb/_static/image38.png)](user-based-authorization-vb/_static/image37.png)</span></span>

<span data-ttu-id="89b5a-408">**그림 13**: tito에 대해 삭제 열 렌더링 ([전체 크기 이미지를 보려면 클릭](user-based-authorization-vb/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="89b5a-408">**Figure 13**: The Delete Column is Rendered for Tito  ([Click to view full-size image](user-based-authorization-vb/_static/image39.png))</span></span>

## <a name="step-4-applying-authorization-rules-to-classes-and-methods"></a><span data-ttu-id="89b5a-409">4 단계: 클래스 및 메서드에 권한 부여 규칙 적용</span><span class="sxs-lookup"><span data-stu-id="89b5a-409">Step 4: Applying Authorization Rules to Classes and Methods</span></span>

<span data-ttu-id="89b5a-410">3 단계에서는 익명 사용자가 파일의 내용을 볼 수 없으며, 파일을 삭제 하는 것을 허용 하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-410">In Step 3 we disallowed anonymous users from viewing a file's contents and prohibited all users but Tito from deleting files.</span></span> <span data-ttu-id="89b5a-411">이는 선언적 및 프로그래밍 기법을 통해 권한 없는 방문자에 대 한 연결 된 사용자 인터페이스 요소를 숨겨서 수행 했습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-411">This was accomplished by hiding the associated user interface elements for unauthorized visitors through declarative and programmatic techniques.</span></span> <span data-ttu-id="89b5a-412">간단한 예제에서는 사용자 인터페이스 요소를 올바르게 숨기는 것은 간단 하지만 동일한 기능을 수행 하는 다양 한 방법이 있을 수 있는 보다 복잡 한 사이트에 대 한 정보는 무엇 인가요?</span><span class="sxs-lookup"><span data-stu-id="89b5a-412">For our simple example, properly hiding the user interface elements was straightforward, but what about more complex sites where there may be many different ways to perform the same functionality?</span></span> <span data-ttu-id="89b5a-413">해당 기능을 권한 없는 사용자로 제한 하면 적용 가능한 모든 사용자 인터페이스 요소를 숨기 거 나 사용 하지 않도록 설정 하는 것을 잊은 경우 어떻게 되나요?</span><span class="sxs-lookup"><span data-stu-id="89b5a-413">In limiting that functionality to unauthorized users, what happens if we forget to hide or disable all of the applicable user interface elements?</span></span>

<span data-ttu-id="89b5a-414">권한이 없는 사용자가 특정 기능의 특정 부분에 액세스할 수 없도록 하는 쉬운 방법은 해당 클래스 또는 메서드를 [`PrincipalPermission` 특성](https://msdn.microsoft.com/library/system.security.permissions.principalpermissionattribute.aspx)으로 데코레이팅 하는 것입니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-414">An easy way to ensure that a particular piece of functionality cannot be accessed by an unauthorized user is to decorate that class or method with the [`PrincipalPermission` attribute](https://msdn.microsoft.com/library/system.security.permissions.principalpermissionattribute.aspx).</span></span> <span data-ttu-id="89b5a-415">.NET 런타임에서 클래스를 사용 하거나 해당 메서드 중 하나를 실행 하는 경우 현재 보안 컨텍스트에 클래스를 사용 하거나 메서드를 실행할 수 있는 권한이 있는지 확인 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-415">When the .NET runtime uses a class or executes one of its methods, it checks to ensure that the current security context has permission to use the class or execute the method.</span></span> <span data-ttu-id="89b5a-416">`PrincipalPermission` 특성은 이러한 규칙을 정의할 수 있는 메커니즘을 제공 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-416">The `PrincipalPermission` attribute provides a mechanism through which we can define these rules.</span></span>

<span data-ttu-id="89b5a-417">GridView의 `SelectedIndexChanged`에 `PrincipalPermission` 특성을 사용 하 고 이벤트 처리기를 `RowDeleting` 하 여 익명 사용자 및 Tito 이외의 사용자가 각각 실행 하지 못하도록 하는 방법을 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-417">Let's demonstrate using the `PrincipalPermission` attribute on the GridView's `SelectedIndexChanged` and `RowDeleting` event handlers to prohibit execution by anonymous users and users other than Tito, respectively.</span></span> <span data-ttu-id="89b5a-418">각 함수 정의 위에 적절 한 특성을 추가 하기만 하면 됩니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-418">All we need to do is add the appropriate attribute atop each function definition:</span></span>

[!code-vb[Main](user-based-authorization-vb/samples/sample22.vb)]

<span data-ttu-id="89b5a-419">`SelectedIndexChanged` 이벤트 처리기에 대 한 특성은 인증 된 사용자만 이벤트 처리기를 실행할 수 있도록 지시 합니다. 여기서 `RowDeleting` 이벤트 처리기의 특성은 실행을 Tito로 제한 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-419">The attribute for the `SelectedIndexChanged` event handler dictates that only authenticated users can execute the event handler, where as the attribute on the `RowDeleting` event handler limits the execution to Tito.</span></span>

> [!NOTE]
> <span data-ttu-id="89b5a-420">특성은 클래스, 메서드, 속성 또는 이벤트에 적용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-420">An attribute can be applied to a class, method, property, or event.</span></span> <span data-ttu-id="89b5a-421">특성을 추가할 때 클래스, 메서드, 속성 또는 이벤트 선언 문의 일부 여야 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-421">When adding an attribute, it must be part of the class, method, property, or event declaration statement.</span></span> <span data-ttu-id="89b5a-422">Visual Basic는 줄 바꿈을 문 구분 기호로 사용 하므로 특성은 선언과 같은 줄에 표시 되거나 줄 연속 문자 (밑줄)를 사용 하 여 바로 위에 표시 되어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-422">Since Visual Basic uses line breaks as statement delimiters, attributes must either appear on the same line as the declaration or directly above it with a line continuation character (the underscore).</span></span> <span data-ttu-id="89b5a-423">위의 코드 조각에서 줄 연속 문자를 사용 하 여 한 줄에 특성을 추가 하 고 메서드 선언을 다른 줄에 추가 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-423">In the code snippet above, the line continuation character is used to place the attribute on one line and the method declaration on another.</span></span>

<span data-ttu-id="89b5a-424">이 `RowDeleting` 이벤트 처리기 또는 인증 되지 않은 사용자가 `SelectedIndexChanged` 이벤트 처리기를 실행 하려고 시도 하는 경우, .NET 런타임에서 `SecurityException`발생 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-424">If, somehow, a user other than Tito attempts to execute the `RowDeleting` event handler or a non-authenticated user attempts to execute the `SelectedIndexChanged` event handler, the .NET runtime will raise a `SecurityException`.</span></span>

<span data-ttu-id="89b5a-425">[![보안 컨텍스트가 메서드를 실행할 수 있는 권한이 없으면 SecurityException이 Throw 됩니다.](user-based-authorization-vb/_static/image41.png)](user-based-authorization-vb/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="89b5a-425">[![If the Security Context is not Authorized to Execute the Method, a SecurityException is Thrown](user-based-authorization-vb/_static/image41.png)](user-based-authorization-vb/_static/image40.png)</span></span>

<span data-ttu-id="89b5a-426">**그림 14**: 보안 컨텍스트에 메서드를 실행할 수 있는 권한이 없는 경우 `SecurityException`이 throw 됩니다 ([전체 크기 이미지를 보려면 클릭](user-based-authorization-vb/_static/image42.png)).</span><span class="sxs-lookup"><span data-stu-id="89b5a-426">**Figure 14**: If the Security Context is not Authorized to Execute the Method, a `SecurityException` is Thrown  ([Click to view full-size image](user-based-authorization-vb/_static/image42.png))</span></span>

> [!NOTE]
> <span data-ttu-id="89b5a-427">여러 보안 컨텍스트에서 클래스 또는 메서드에 액세스 하도록 허용 하려면 클래스 또는 메서드를 각 보안 컨텍스트의 `PrincipalPermission` 특성으로 데코 레이트 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-427">To allow multiple security contexts to access a class or method, decorate the class or method with a `PrincipalPermission` attribute for each security context.</span></span> <span data-ttu-id="89b5a-428">즉, Tito와 Bruce 모두 `RowDeleting` 이벤트 처리기를 실행할 수 있도록 하려면 *두 개의* `PrincipalPermission` 특성을 추가 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-428">That is, to allow both Tito and Bruce to execute the `RowDeleting` event handler, add *two* `PrincipalPermission` attributes:</span></span>

[!code-vb[Main](user-based-authorization-vb/samples/sample23.vb)]

<span data-ttu-id="89b5a-429">ASP.NET 페이지 외에도 많은 응용 프로그램에는 비즈니스 논리 및 데이터 액세스 계층과 같은 다양 한 계층을 포함 하는 아키텍처가 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-429">In addition to ASP.NET pages, many applications also have an architecture that includes various layers, such as Business Logic and Data Access Layers.</span></span> <span data-ttu-id="89b5a-430">이러한 계층은 일반적으로 클래스 라이브러리로 구현 되며 비즈니스 논리 및 데이터 관련 기능을 수행 하기 위한 구현 클래스와 메서드를 제공 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-430">These layers are typically implemented as Class Libraries and offer classes and methods for performing business logic- and data-related functionality.</span></span> <span data-ttu-id="89b5a-431">`PrincipalPermission` 특성은 이러한 계층에 권한 부여 규칙을 적용 하는 데 유용 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-431">The `PrincipalPermission` attribute is useful for applying authorization rules to these layers.</span></span>

<span data-ttu-id="89b5a-432">`PrincipalPermission` 특성을 사용 하 여 클래스 및 메서드에 대 한 권한 부여 규칙을 정의 하는 방법에 대 한 자세한 내용은 [Scott Guthrie](https://weblogs.asp.net/scottgu/)의 블로그 항목 [`PrincipalPermissionAttributes`를 사용 하 여 비즈니스 및 데이터 계층에 권한 부여 규칙 추가 ](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx)를 참조 하세요.</span><span class="sxs-lookup"><span data-stu-id="89b5a-432">For more information on using the `PrincipalPermission` attribute to define authorization rules on classes and methods, refer to [Scott Guthrie](https://weblogs.asp.net/scottgu/)'s blog entry [Adding Authorization Rules to Business and Data Layers Using `PrincipalPermissionAttributes`](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx).</span></span>

## <a name="summary"></a><span data-ttu-id="89b5a-433">요약</span><span class="sxs-lookup"><span data-stu-id="89b5a-433">Summary</span></span>

<span data-ttu-id="89b5a-434">이 자습서에서는 사용자 기반 권한 부여 규칙을 적용 하는 방법을 살펴보았습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-434">In this tutorial we looked at how to apply user-based authorization rules.</span></span> <span data-ttu-id="89b5a-435">ASP를 살펴보세요. NET의 URL 권한 부여 프레임 워크입니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-435">We started with a look at ASP.NET's URL authorization framework.</span></span> <span data-ttu-id="89b5a-436">각 요청에서 ASP.NET 엔진의 `UrlAuthorizationModule`는 응용 프로그램의 구성에 정의 된 URL 권한 부여 규칙을 검사 하 여 해당 id가 요청 된 리소스에 액세스할 수 있는 권한이 있는지 여부를 확인 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-436">On each request, the ASP.NET engine's `UrlAuthorizationModule` inspects the URL authorization rules defined in the application's configuration to determine whether the identity is authorized to access the requested resource.</span></span> <span data-ttu-id="89b5a-437">간단히 말해서 URL 권한 부여를 사용 하면 특정 페이지 또는 특정 디렉터리에 있는 모든 페이지에 대 한 권한 부여 규칙을 쉽게 지정할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-437">In short, URL authorization makes it easy to specify authorization rules for a specific page or for all pages in a particular directory.</span></span>

<span data-ttu-id="89b5a-438">URL 권한 부여 프레임 워크는 페이지 별로 권한 부여 규칙을 적용 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-438">The URL authorization framework applies authorization rules on a page-by-page basis.</span></span> <span data-ttu-id="89b5a-439">URL 권한 부여를 사용 하면 요청 하는 id에 특정 리소스에 액세스할 수 있는 권한이 부여 됩니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-439">With URL authorization, either the requesting identity is authorized to access a particular resource or not.</span></span> <span data-ttu-id="89b5a-440">그러나 많은 시나리오에서 보다 세부적인 권한 부여 규칙을 호출 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-440">Many scenarios, however, call for more fine grain authorization rules.</span></span> <span data-ttu-id="89b5a-441">페이지에 액세스할 수 있는 사용자를 정의 하는 대신 모든 사람이 페이지에 액세스 하도록 허용 하 고 다른 데이터를 표시 하거나 페이지를 방문 하는 사용자에 따라 다른 기능을 제공 해야 할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-441">Rather than defining who is permitted to access a page, we may need to let everyone access a page, but to show different data or offer different functionality depending on the user visiting the page.</span></span> <span data-ttu-id="89b5a-442">페이지 수준 권한 부여는 권한이 없는 사용자가 금지 기능에 액세스 하지 못하도록 하기 위해 특정 사용자 인터페이스 요소를 숨기는 것을 포함 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-442">Page-level authorization usually involves hiding specific user interface elements in order to prevent unauthorized users from accessing prohibited functionality.</span></span> <span data-ttu-id="89b5a-443">또한 특성을 사용 하 여 클래스에 대 한 액세스를 제한 하 고 특정 사용자에 대 한 메서드를 실행할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-443">Additionally, it is possible to use attributes to restrict access to classes and execution of its methods for certain users.</span></span>

<span data-ttu-id="89b5a-444">행복 한 프로그래밍</span><span class="sxs-lookup"><span data-stu-id="89b5a-444">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="89b5a-445">추가 참고 자료</span><span class="sxs-lookup"><span data-stu-id="89b5a-445">Further Reading</span></span>

<span data-ttu-id="89b5a-446">이 자습서에서 설명 하는 항목에 대 한 자세한 내용은 다음 리소스를 참조 하세요.</span><span class="sxs-lookup"><span data-stu-id="89b5a-446">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="89b5a-447">`PrincipalPermissionAttributes`를 사용 하 여 비즈니스 및 데이터 계층에 권한 부여 규칙 추가</span><span class="sxs-lookup"><span data-stu-id="89b5a-447">Adding Authorization Rules to Business and Data Layers Using `PrincipalPermissionAttributes`</span></span>](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx)
- [<span data-ttu-id="89b5a-448">ASP.NET 권한 부여</span><span class="sxs-lookup"><span data-stu-id="89b5a-448">ASP.NET Authorization</span></span>](https://msdn.microsoft.com/library/wce3kxhd.aspx)
- [<span data-ttu-id="89b5a-449">IIS6와 IIS7 보안 간의 변경 내용</span><span class="sxs-lookup"><span data-stu-id="89b5a-449">Changes Between IIS6 and IIS7 Security</span></span>](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/Changes-between-IIS6-and-IIS7-Security)
- [<span data-ttu-id="89b5a-450">특정 파일 및 하위 디렉터리 구성</span><span class="sxs-lookup"><span data-stu-id="89b5a-450">Configuring Specific Files and Subdirectories</span></span>](https://msdn.microsoft.com/library/6hbkh9s7.aspx)
- [<span data-ttu-id="89b5a-451">사용자에 따라 데이터 수정 기능 제한</span><span class="sxs-lookup"><span data-stu-id="89b5a-451">Limiting Data Modification Functionality Based on the User</span></span>](../../data-access/editing-inserting-and-deleting-data/limiting-data-modification-functionality-based-on-the-user-vb.md)
- [<span data-ttu-id="89b5a-452">LoginView 컨트롤 빠른 시작</span><span class="sxs-lookup"><span data-stu-id="89b5a-452">LoginView Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/login/loginview.aspx)
- [<span data-ttu-id="89b5a-453">IIS7 URL 권한 부여 이해</span><span class="sxs-lookup"><span data-stu-id="89b5a-453">Understanding IIS7 URL Authorization</span></span>](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/URL-Authorization/Understanding-IIS7-URL-Authorization)
- [<span data-ttu-id="89b5a-454">`UrlAuthorizationModule` 기술 문서</span><span class="sxs-lookup"><span data-stu-id="89b5a-454">`UrlAuthorizationModule` Technical Documentation</span></span>](https://msdn.microsoft.com/library/system.web.security.urlauthorizationmodule.aspx)
- [<span data-ttu-id="89b5a-455">ASP.NET 2.0에서 데이터 작업</span><span class="sxs-lookup"><span data-stu-id="89b5a-455">Working with Data in ASP.NET 2.0</span></span>](../../data-access/index.md)

### <a name="about-the-author"></a><span data-ttu-id="89b5a-456">저자 정보</span><span class="sxs-lookup"><span data-stu-id="89b5a-456">About the Author</span></span>

<span data-ttu-id="89b5a-457">Scott Mitchell는 여러 ASP/ASP. NET books의 작성자와 4GuysFromRolla.com의 창립자가 1998부터 Microsoft 웹 기술을 사용 하 여 작업 했습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-457">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="89b5a-458">Scott은 독립 컨설턴트, 강사 및 기록기로 작동 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-458">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="89b5a-459">최신 책은 *[24 시간 이내에 ASP.NET 2.0을 sams teach yourself](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)* 것입니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-459">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="89b5a-460">Scott은 [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) 또는 [http://ScottOnWriting.NET](http://scottonwriting.net/)의 블로그를 통해 연결할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-460">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="89b5a-461">특별히 감사 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-461">Special Thanks To</span></span>

<span data-ttu-id="89b5a-462">이 자습서 시리즈는 많은 유용한 검토자가 검토 했습니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-462">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="89b5a-463">예정 된 MSDN 문서를 검토 하는 데 관심이 있나요?</span><span class="sxs-lookup"><span data-stu-id="89b5a-463">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="89b5a-464">그렇다면 [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)에서 줄을 삭제 합니다.</span><span class="sxs-lookup"><span data-stu-id="89b5a-464">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="89b5a-465">[이전](validating-user-credentials-against-the-membership-user-store-vb.md)
> [다음](storing-additional-user-information-vb.md)</span><span class="sxs-lookup"><span data-stu-id="89b5a-465">[Previous](validating-user-credentials-against-the-membership-user-store-vb.md)
[Next](storing-additional-user-information-vb.md)</span></span>
