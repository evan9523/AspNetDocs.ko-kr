---
uid: identity/overview/migrations/migrating-an-existing-website-from-sql-membership-to-aspnet-identity
title: 기존 웹 사이트를 SQL 멤버 자격에서 ASP.NET Identity-ASP.NET 4.x로 마이그레이션
author: Rick-Anderson
description: 이 자습서에서는 SQL 멤버 자격을 사용 하 여 만든 사용자 및 역할 데이터를 사용 하 여 기존 웹 응용 프로그램을 새 ASP.NET Identity s로 마이그레이션하는 단계를 보여 줍니다.
ms.author: riande
ms.date: 12/19/2014
ms.custom: seoapril2019
ms.assetid: 220d3d75-16b2-4240-beae-a5b534f06419
msc.legacyurl: /identity/overview/migrations/migrating-an-existing-website-from-sql-membership-to-aspnet-identity
msc.type: authoredcontent
ms.openlocfilehash: 633229cc4311d151121bf6a91b9fa8aeecca1197
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78471635"
---
# <a name="migrating-an-existing-website-from-sql-membership-to-aspnet-identity"></a><span data-ttu-id="a373e-103">기존 웹 사이트를 SQL 멤버 자격에서 ASP.NET Identity로 마이그레이션</span><span class="sxs-lookup"><span data-stu-id="a373e-103">Migrating an Existing Website from SQL Membership to ASP.NET Identity</span></span>

<span data-ttu-id="a373e-104">[Rick Anderson](https://twitter.com/RickAndMSFT), [suhas Joshi](https://github.com/suhasj)</span><span class="sxs-lookup"><span data-stu-id="a373e-104">by [Rick Anderson](https://twitter.com/RickAndMSFT), [Suhas Joshi](https://github.com/suhasj)</span></span>

> <span data-ttu-id="a373e-105">이 자습서에서는 새 ASP.NET Identity 시스템에 SQL 멤버 자격을 사용 하 여 만든 사용자 및 역할 데이터를 사용 하 여 기존 웹 응용 프로그램을 마이그레이션하는 단계를 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-105">This tutorial illustrates the steps to migrate an existing web application with user and role data created using SQL Membership to the new ASP.NET Identity system.</span></span> <span data-ttu-id="a373e-106">이 방법은 기존 데이터베이스 스키마를 ASP.NET Identity에 필요한 것으로 변경 하 고 이전/새 클래스에 연결 하는 것을 포함 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-106">This approach involves changing the existing database schema to the one needed by the ASP.NET Identity and hook in the old/new classes to it.</span></span> <span data-ttu-id="a373e-107">이 접근 방식을 채택 하 고 나면 데이터베이스를 마이그레이션한 후에 Id에 대 한 향후 업데이트를 손쉽게 처리할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-107">After you adopt this approach, once your database is migrated, future updates to Identity will be handled effortlessly.</span></span>

<span data-ttu-id="a373e-108">이 자습서에서는 사용자 및 역할 데이터를 만들기 위해 Visual Studio 2010을 사용 하 여 만든 웹 응용 프로그램 템플릿 (Web Forms)을 사용 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-108">For this tutorial, we will take a web application template (Web Forms) created using Visual Studio 2010 to create user and role data.</span></span> <span data-ttu-id="a373e-109">그런 다음 SQL 스크립트를 사용 하 여 기존 데이터베이스를 Id 시스템에 필요한 테이블로 마이그레이션합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-109">We will then use SQL scripts to migrate the existing database to tables needed by the Identity system.</span></span> <span data-ttu-id="a373e-110">다음으로 필요한 NuGet 패키지를 설치 하 고 멤버 관리를 위해 Id 시스템을 사용 하는 새 계정 관리 페이지를 추가 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-110">Next we'll install the necessary NuGet packages and add new account management pages which use the Identity system for membership management.</span></span> <span data-ttu-id="a373e-111">마이그레이션을 테스트 하면 SQL 멤버 자격을 사용 하 여 만든 사용자가 로그인 할 수 있어야 하 고 새 사용자가 등록할 수 있어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-111">As a test of migration, users created using SQL membership should be able to log in and new users should be able to register.</span></span> <span data-ttu-id="a373e-112">전체 샘플은 [여기](https://github.com/aspnet/samples/tree/master/samples/aspnet/Identity/SQLMembership-Identity-OWIN/)에서 찾을 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-112">You can find the complete sample [here](https://github.com/aspnet/samples/tree/master/samples/aspnet/Identity/SQLMembership-Identity-OWIN/).</span></span> <span data-ttu-id="a373e-113">또한 [ASP.NET Membership에서 ASP.NET Identity로 마이그레이션을](http://travis.io/blog/2015/03/24/migrate-from-aspnet-membership-to-aspnet-identity.html)참조 하세요.</span><span class="sxs-lookup"><span data-stu-id="a373e-113">See also [Migrating from ASP.NET Membership to ASP.NET Identity](http://travis.io/blog/2015/03/24/migrate-from-aspnet-membership-to-aspnet-identity.html).</span></span>

## <a name="getting-started"></a><span data-ttu-id="a373e-114">시작</span><span class="sxs-lookup"><span data-stu-id="a373e-114">Getting started</span></span>

### <a name="creating-an-application-with-sql-membership"></a><span data-ttu-id="a373e-115">SQL 멤버 자격으로 응용 프로그램 만들기</span><span class="sxs-lookup"><span data-stu-id="a373e-115">Creating an application with SQL Membership</span></span>

1. <span data-ttu-id="a373e-116">SQL 멤버 자격을 사용 하 고 사용자 및 역할 데이터를 포함 하는 기존 응용 프로그램으로 시작 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-116">We need to start with an existing application that uses SQL membership and has user and role data.</span></span> <span data-ttu-id="a373e-117">이 문서의 목적을 위해 Visual Studio 2010에서 웹 응용 프로그램을 만들어 보겠습니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-117">For the purpose of this article, let's create a web application in Visual Studio 2010.</span></span>

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image1.jpg)
2. <span data-ttu-id="a373e-118">ASP.NET 구성 도구를 사용 하 여 두 명의 사용자 ( **Oldadminuser** 및 **olduser** )를 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-118">Using the ASP.NET Configuration tool, create 2 users: **oldAdminUser** and **oldUser.**</span></span>

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image1.png)

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image2.jpg)
3. <span data-ttu-id="a373e-119">Admin 이라는 역할을 만들고 해당 역할에 사용자로 ' oldAdminUser '를 추가 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-119">Create a role named Admin and add 'oldAdminUser' as a user in that role.</span></span>

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image2.png)
4. <span data-ttu-id="a373e-120">Default.aspx를 사용 하 여 사이트의 관리 섹션을 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-120">Create an Admin section of the site with a Default.aspx.</span></span> <span data-ttu-id="a373e-121">관리자 역할의 사용자만 액세스할 수 있도록 web.config 파일에 권한 부여 태그를 설정 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-121">Set the authorization tag in the web.config file to enable access only to users in Admin roles.</span></span> <span data-ttu-id="a373e-122">자세한 내용은 여기를 참조 하세요 [https://www.asp.net/web-forms/tutorials/security/roles/role-based-authorization-cs](../../../web-forms/overview/older-versions-security/roles/role-based-authorization-cs.md)</span><span class="sxs-lookup"><span data-stu-id="a373e-122">More information can be found here [https://www.asp.net/web-forms/tutorials/security/roles/role-based-authorization-cs](../../../web-forms/overview/older-versions-security/roles/role-based-authorization-cs.md)</span></span>

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image3.png)
5. <span data-ttu-id="a373e-123">SQL 멤버 자격 시스템에서 만든 테이블을 이해 하려면 서버 탐색기에서 데이터베이스를 확인 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-123">View the database in Server Explorer to understand the tables created by the SQL membership system.</span></span> <span data-ttu-id="a373e-124">사용자 로그인 데이터는 aspnet\_사용자 및 aspnet\_멤버 자격 테이블에 저장 되는 반면 역할 데이터는 aspnet\_역할 테이블에 저장 됩니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-124">The user login data is stored in the aspnet\_Users and aspnet\_Membership tables, while role data is stored in the aspnet\_Roles table.</span></span> <span data-ttu-id="a373e-125">Aspnet\_UsersInRoles 테이블에 역할이 저장 되는 사용자에 대 한 정보입니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-125">Information about which users are in which roles is stored in the aspnet\_UsersInRoles table.</span></span> <span data-ttu-id="a373e-126">기본 멤버 관리를 위해 위의 표에 있는 정보를 ASP.NET Identity 시스템으로 이식 하는 것으로 충분 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-126">For basic membership management it is sufficient to port the information in the above tables to the ASP.NET Identity system.</span></span>

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image4.png)

### <a name="migrating-to-visual-studio-2013"></a><span data-ttu-id="a373e-127">Visual Studio 2013로 마이그레이션</span><span class="sxs-lookup"><span data-stu-id="a373e-127">Migrating to Visual Studio 2013</span></span>

1. <span data-ttu-id="a373e-128">[최신 업데이트](https://www.microsoft.com/download/details.aspx?id=44921)와 함께 웹 또는 Visual Studio 2013에 대 한 Visual Studio Express 2013을 설치 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-128">Install Visual Studio Express 2013 for Web or Visual Studio 2013 along with the [latest updates](https://www.microsoft.com/download/details.aspx?id=44921).</span></span>
2. <span data-ttu-id="a373e-129">설치 된 Visual Studio 버전에서 위의 프로젝트를 엽니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-129">Open the above project in your installed version of Visual Studio.</span></span> <span data-ttu-id="a373e-130">컴퓨터에 SQL Server Express 설치 되어 있지 않은 경우에는 연결 문자열에 SQL Express가 사용 되므로 프로젝트를 열 때 프롬프트가 표시 됩니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-130">If SQL Server Express is not installed on the machine, a prompt is displayed when you open the project, since the connection string uses SQL Express.</span></span> <span data-ttu-id="a373e-131">SQL Express를 설치 하도록 선택 하거나 관련 작업을 수행 하 여 연결 문자열을 LocalDb로 변경할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-131">You can either choose to install SQL Express or as work around change the connection string to LocalDb.</span></span> <span data-ttu-id="a373e-132">이 문서에서는 LocalDb로 변경 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-132">For this article we'll change it to LocalDb.</span></span>
3. <span data-ttu-id="a373e-133">Web.config를 열고에서 연결 문자열을 변경 합니다. SQLExpress에서 (LocalDb) v 11.0입니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-133">Open web.config and change the connection string from .SQLExpress to (LocalDb)v11.0.</span></span> <span data-ttu-id="a373e-134">연결 문자열에서 ' User Instance = t r u e '를 제거 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-134">Remove 'User Instance=true' from the connection string.</span></span>

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image3.jpg)
4. <span data-ttu-id="a373e-135">서버 탐색기를 열고 테이블 스키마 및 데이터를 관찰할 수 있는지 확인 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-135">Open Server Explorer and verify that the table schema and data can be observed.</span></span>
5. <span data-ttu-id="a373e-136">ASP.NET Identity 시스템은 버전 4.5 이상의 프레임 워크에서 작동 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-136">The ASP.NET Identity system works with version 4.5 or higher of the framework.</span></span> <span data-ttu-id="a373e-137">응용 프로그램 대상을 4.5 이상으로 변경 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-137">Retarget the application to 4.5 or higher.</span></span>

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image5.png)

    <span data-ttu-id="a373e-138">프로젝트를 빌드하여 오류가 없는지 확인 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-138">Build the project to verify that there are no errors.</span></span>

### <a name="installing-the-nuget-packages"></a><span data-ttu-id="a373e-139">Nuget 패키지 설치</span><span class="sxs-lookup"><span data-stu-id="a373e-139">Installing the Nuget packages</span></span>

1. <span data-ttu-id="a373e-140">솔루션 탐색기에서 프로젝트를 마우스 오른쪽 단추로 클릭 하 &gt; **NuGet 패키지 관리**를 클릭 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-140">In Solution Explorer, right-click the project &gt; **Manage NuGet Packages**.</span></span> <span data-ttu-id="a373e-141">검색 상자에 "Asp.net Identity"를 입력 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-141">In the search box, enter "Asp.net Identity".</span></span> <span data-ttu-id="a373e-142">결과 목록에서 패키지를 선택 하 고 설치를 클릭 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-142">Select the package in the list of results and click install.</span></span> <span data-ttu-id="a373e-143">"동의 함" 단추를 클릭 하 여 사용권 계약에 동의 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-143">Accept the license agreement by clicking on "I Accept" button.</span></span> <span data-ttu-id="a373e-144">이 패키지는 종속성 패키지를 설치 합니다. EntityFramework 및 Microsoft ASP.NET Identity Core를 참조 하세요.</span><span class="sxs-lookup"><span data-stu-id="a373e-144">Note that this package will install the dependency packages: EntityFramework and Microsoft ASP.NET Identity Core.</span></span> <span data-ttu-id="a373e-145">마찬가지로 다음 패키지를 설치 합니다 (OAuth 로그인을 사용 하도록 설정 하지 않으려면 마지막 4 OWIN 패키지를 건너뜀).</span><span class="sxs-lookup"><span data-stu-id="a373e-145">Similarly install the following packages (skip the last 4 OWIN packages if you don't want to enable OAuth log-in):</span></span>

   - <span data-ttu-id="a373e-146">Microsoft.AspNet.Identity.Owin</span><span class="sxs-lookup"><span data-stu-id="a373e-146">Microsoft.AspNet.Identity.Owin</span></span>
   - <span data-ttu-id="a373e-147">Microsoft.Owin.Host.SystemWeb</span><span class="sxs-lookup"><span data-stu-id="a373e-147">Microsoft.Owin.Host.SystemWeb</span></span>
   - <span data-ttu-id="a373e-148">Microsoft.Owin.Security.Facebook</span><span class="sxs-lookup"><span data-stu-id="a373e-148">Microsoft.Owin.Security.Facebook</span></span>
   - <span data-ttu-id="a373e-149">Microsoft.Owin.Security.Google</span><span class="sxs-lookup"><span data-stu-id="a373e-149">Microsoft.Owin.Security.Google</span></span>
   - <span data-ttu-id="a373e-150">Microsoft.Owin.Security.MicrosoftAccount</span><span class="sxs-lookup"><span data-stu-id="a373e-150">Microsoft.Owin.Security.MicrosoftAccount</span></span>
   - <span data-ttu-id="a373e-151">Microsoft.Owin.Security.Twitter</span><span class="sxs-lookup"><span data-stu-id="a373e-151">Microsoft.Owin.Security.Twitter</span></span>

     ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image6.png)

### <a name="migrate-database-to-the-new-identity-system"></a><span data-ttu-id="a373e-152">새 Id 시스템으로 데이터베이스 마이그레이션</span><span class="sxs-lookup"><span data-stu-id="a373e-152">Migrate database to the new Identity system</span></span>

<span data-ttu-id="a373e-153">다음 단계는 기존 데이터베이스를 ASP.NET Identity 시스템에 필요한 스키마로 마이그레이션하는 것입니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-153">The next step is to migrate the existing database to a schema required by the ASP.NET Identity system.</span></span> <span data-ttu-id="a373e-154">이를 위해 새 테이블을 만들고 기존 사용자 정보를 새 테이블로 마이그레이션하는 일련의 명령이 있는 SQL 스크립트를 실행 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-154">To achieve this we run a SQL script which has a set of commands to create new tables and migrate existing user information to the new tables.</span></span> <span data-ttu-id="a373e-155">스크립트 파일은 [여기](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/SQLMembership-Identity-OWIN/Migrations.sql)에서 찾을 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-155">The script file can be found [here](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/SQLMembership-Identity-OWIN/Migrations.sql).</span></span>

<span data-ttu-id="a373e-156">이 스크립트 파일은이 샘플과 관련 된 것입니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-156">This script file is specific to this sample.</span></span> <span data-ttu-id="a373e-157">SQL 멤버 자격을 사용 하 여 만든 테이블에 대 한 스키마가 사용자 지정 되거나 수정 된 경우에는 스크립트를 적절 하 게 변경 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-157">If the schema for the tables created using SQL membership is customized or modified the scripts need to be changed accordingly.</span></span>

### <a name="how-to-generate-the-sql-script-for-schema-migration"></a><span data-ttu-id="a373e-158">스키마 마이그레이션을 위한 SQL 스크립트를 생성 하는 방법</span><span class="sxs-lookup"><span data-stu-id="a373e-158">How to generate the SQL script for schema migration</span></span>

<span data-ttu-id="a373e-159">ASP.NET Identity 클래스가 기존 사용자의 데이터와 함께 작동 하 게 하려면 데이터베이스 스키마를 ASP.NET Identity에 필요한 것으로 마이그레이션해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-159">For ASP.NET Identity classes to work out of the box with the data of existing users, we need to migrate the database schema to the one needed by ASP.NET Identity.</span></span> <span data-ttu-id="a373e-160">새 테이블을 추가 하 고 해당 테이블에 기존 정보를 복사 하 여이 작업을 수행할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-160">We can do this by adding new tables and copying the existing information to those tables.</span></span> <span data-ttu-id="a373e-161">기본적으로 ASP.NET Identity는 EntityFramework를 사용 하 여 Id 모델 클래스를 데이터베이스에 다시 매핑하여 정보를 저장/검색 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-161">By default ASP.NET Identity uses EntityFramework to map the Identity model classes back to the database to store/retrieve information.</span></span> <span data-ttu-id="a373e-162">이러한 모델 클래스는 사용자 및 역할 개체를 정의 하는 핵심 Id 인터페이스를 구현 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-162">These model classes implement the core Identity interfaces defining user and role objects.</span></span> <span data-ttu-id="a373e-163">데이터베이스의 테이블과 열은 이러한 모델 클래스를 기반으로 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-163">The tables and the columns in the database are based on these model classes.</span></span> <span data-ttu-id="a373e-164">Id v 2.1.0의 EntityFramework 모델 클래스와 해당 속성은 아래에 정의 되어 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-164">The EntityFramework model classes in Identity v2.1.0 and their properties are as defined below</span></span>

| <span data-ttu-id="a373e-165">**IdentityUser**</span><span class="sxs-lookup"><span data-stu-id="a373e-165">**IdentityUser**</span></span> | <span data-ttu-id="a373e-166">**형식**</span><span class="sxs-lookup"><span data-stu-id="a373e-166">**Type**</span></span> | <span data-ttu-id="a373e-167">**IdentityRole**</span><span class="sxs-lookup"><span data-stu-id="a373e-167">**IdentityRole**</span></span> | <span data-ttu-id="a373e-168">**IdentityUserRole**</span><span class="sxs-lookup"><span data-stu-id="a373e-168">**IdentityUserRole**</span></span> | <span data-ttu-id="a373e-169">**IdentityUserLogin**</span><span class="sxs-lookup"><span data-stu-id="a373e-169">**IdentityUserLogin**</span></span> | <span data-ttu-id="a373e-170">**IdentityUserClaim**</span><span class="sxs-lookup"><span data-stu-id="a373e-170">**IdentityUserClaim**</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="a373e-171">Id</span><span class="sxs-lookup"><span data-stu-id="a373e-171">Id</span></span> | <span data-ttu-id="a373e-172">문자열</span><span class="sxs-lookup"><span data-stu-id="a373e-172">string</span></span> | <span data-ttu-id="a373e-173">Id</span><span class="sxs-lookup"><span data-stu-id="a373e-173">Id</span></span> | <span data-ttu-id="a373e-174">RoleId</span><span class="sxs-lookup"><span data-stu-id="a373e-174">RoleId</span></span> | <span data-ttu-id="a373e-175">ProviderKey</span><span class="sxs-lookup"><span data-stu-id="a373e-175">ProviderKey</span></span> | <span data-ttu-id="a373e-176">Id</span><span class="sxs-lookup"><span data-stu-id="a373e-176">Id</span></span> |
| <span data-ttu-id="a373e-177">사용자 이름</span><span class="sxs-lookup"><span data-stu-id="a373e-177">Username</span></span> | <span data-ttu-id="a373e-178">문자열</span><span class="sxs-lookup"><span data-stu-id="a373e-178">string</span></span> | <span data-ttu-id="a373e-179">속성</span><span class="sxs-lookup"><span data-stu-id="a373e-179">Name</span></span> | <span data-ttu-id="a373e-180">UserId</span><span class="sxs-lookup"><span data-stu-id="a373e-180">UserId</span></span> | <span data-ttu-id="a373e-181">UserId</span><span class="sxs-lookup"><span data-stu-id="a373e-181">UserId</span></span> | <span data-ttu-id="a373e-182">ClaimType</span><span class="sxs-lookup"><span data-stu-id="a373e-182">ClaimType</span></span> |
| <span data-ttu-id="a373e-183">PasswordHash</span><span class="sxs-lookup"><span data-stu-id="a373e-183">PasswordHash</span></span> | <span data-ttu-id="a373e-184">문자열</span><span class="sxs-lookup"><span data-stu-id="a373e-184">string</span></span> |  |  | <span data-ttu-id="a373e-185">LoginProvider</span><span class="sxs-lookup"><span data-stu-id="a373e-185">LoginProvider</span></span> | <span data-ttu-id="a373e-186">ClaimValue</span><span class="sxs-lookup"><span data-stu-id="a373e-186">ClaimValue</span></span> |
| <span data-ttu-id="a373e-187">SecurityStamp</span><span class="sxs-lookup"><span data-stu-id="a373e-187">SecurityStamp</span></span> | <span data-ttu-id="a373e-188">문자열</span><span class="sxs-lookup"><span data-stu-id="a373e-188">string</span></span> |  |  |  | <span data-ttu-id="a373e-189">사용자\_Id</span><span class="sxs-lookup"><span data-stu-id="a373e-189">User\_Id</span></span> |
| <span data-ttu-id="a373e-190">Email</span><span class="sxs-lookup"><span data-stu-id="a373e-190">Email</span></span> | <span data-ttu-id="a373e-191">문자열</span><span class="sxs-lookup"><span data-stu-id="a373e-191">string</span></span> |  |  |  |  |
| <span data-ttu-id="a373e-192">EmailConfirmed</span><span class="sxs-lookup"><span data-stu-id="a373e-192">EmailConfirmed</span></span> | <span data-ttu-id="a373e-193">bool</span><span class="sxs-lookup"><span data-stu-id="a373e-193">bool</span></span> |  |  |  |  |
| <span data-ttu-id="a373e-194">PhoneNumber</span><span class="sxs-lookup"><span data-stu-id="a373e-194">PhoneNumber</span></span> | <span data-ttu-id="a373e-195">문자열</span><span class="sxs-lookup"><span data-stu-id="a373e-195">string</span></span> |  |  |  |  |
| <span data-ttu-id="a373e-196">PhoneNumberConfirmed</span><span class="sxs-lookup"><span data-stu-id="a373e-196">PhoneNumberConfirmed</span></span> | <span data-ttu-id="a373e-197">bool</span><span class="sxs-lookup"><span data-stu-id="a373e-197">bool</span></span> |  |  |  |  |
| <span data-ttu-id="a373e-198">LockoutEnabled</span><span class="sxs-lookup"><span data-stu-id="a373e-198">LockoutEnabled</span></span> | <span data-ttu-id="a373e-199">bool</span><span class="sxs-lookup"><span data-stu-id="a373e-199">bool</span></span> |  |  |  |  |
| <span data-ttu-id="a373e-200">LockoutEndDate</span><span class="sxs-lookup"><span data-stu-id="a373e-200">LockoutEndDate</span></span> | <span data-ttu-id="a373e-201">DateTime</span><span class="sxs-lookup"><span data-stu-id="a373e-201">DateTime</span></span> |  |  |  |  |
| <span data-ttu-id="a373e-202">AccessFailedCount</span><span class="sxs-lookup"><span data-stu-id="a373e-202">AccessFailedCount</span></span> | <span data-ttu-id="a373e-203">int</span><span class="sxs-lookup"><span data-stu-id="a373e-203">int</span></span> |  |  |  |  |

<span data-ttu-id="a373e-204">이러한 각 모델에 대 한 테이블은 속성에 해당 하는 열이 있어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-204">We need to have tables for each of these models with columns corresponding to the properties.</span></span> <span data-ttu-id="a373e-205">클래스와 테이블 간의 매핑은 `IdentityDBContext`의 `OnModelCreating` 메서드에서 정의 됩니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-205">The mapping between classes and tables is defined in the `OnModelCreating` method of the `IdentityDBContext`.</span></span> <span data-ttu-id="a373e-206">이를 구성의 흐름 API 방법 이라고 하며, 자세한 내용은 [여기](https://msdn.microsoft.com/data/jj591617.aspx)를 참조 하세요.</span><span class="sxs-lookup"><span data-stu-id="a373e-206">This is known as the fluent API method of configuration and more information can be found [here](https://msdn.microsoft.com/data/jj591617.aspx).</span></span> <span data-ttu-id="a373e-207">클래스에 대 한 구성은 아래에서 설명 하는 것과 같습니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-207">The configuration for the classes is as mentioned below</span></span>

| <span data-ttu-id="a373e-208">**클래스**</span><span class="sxs-lookup"><span data-stu-id="a373e-208">**Class**</span></span> | <span data-ttu-id="a373e-209">**테이블**</span><span class="sxs-lookup"><span data-stu-id="a373e-209">**Table**</span></span> | <span data-ttu-id="a373e-210">**기본 키**</span><span class="sxs-lookup"><span data-stu-id="a373e-210">**Primary key**</span></span> | <span data-ttu-id="a373e-211">**외래 키**</span><span class="sxs-lookup"><span data-stu-id="a373e-211">**Foreign key**</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="a373e-212">IdentityUser</span><span class="sxs-lookup"><span data-stu-id="a373e-212">IdentityUser</span></span> | <span data-ttu-id="a373e-213">AspnetUsers</span><span class="sxs-lookup"><span data-stu-id="a373e-213">AspnetUsers</span></span> | <span data-ttu-id="a373e-214">Id</span><span class="sxs-lookup"><span data-stu-id="a373e-214">Id</span></span> |  |
| <span data-ttu-id="a373e-215">IdentityRole</span><span class="sxs-lookup"><span data-stu-id="a373e-215">IdentityRole</span></span> | <span data-ttu-id="a373e-216">AspnetRoles</span><span class="sxs-lookup"><span data-stu-id="a373e-216">AspnetRoles</span></span> | <span data-ttu-id="a373e-217">Id</span><span class="sxs-lookup"><span data-stu-id="a373e-217">Id</span></span> |  |
| <span data-ttu-id="a373e-218">IdentityUserRole</span><span class="sxs-lookup"><span data-stu-id="a373e-218">IdentityUserRole</span></span> | <span data-ttu-id="a373e-219">AspnetUserRole</span><span class="sxs-lookup"><span data-stu-id="a373e-219">AspnetUserRole</span></span> | <span data-ttu-id="a373e-220">UserId + RoleId</span><span class="sxs-lookup"><span data-stu-id="a373e-220">UserId + RoleId</span></span> | <span data-ttu-id="a373e-221">사용자\_Id-&gt;AspnetUsers RoleId-&gt;AspnetRoles</span><span class="sxs-lookup"><span data-stu-id="a373e-221">User\_Id-&gt;AspnetUsers RoleId-&gt;AspnetRoles</span></span> |
| <span data-ttu-id="a373e-222">IdentityUserLogin</span><span class="sxs-lookup"><span data-stu-id="a373e-222">IdentityUserLogin</span></span> | <span data-ttu-id="a373e-223">AspnetUserLogins</span><span class="sxs-lookup"><span data-stu-id="a373e-223">AspnetUserLogins</span></span> | <span data-ttu-id="a373e-224">ProviderKey + UserId + LoginProvider</span><span class="sxs-lookup"><span data-stu-id="a373e-224">ProviderKey+UserId + LoginProvider</span></span> | <span data-ttu-id="a373e-225">UserId-&gt;AspnetUsers</span><span class="sxs-lookup"><span data-stu-id="a373e-225">UserId-&gt;AspnetUsers</span></span> |
| <span data-ttu-id="a373e-226">IdentityUserClaim</span><span class="sxs-lookup"><span data-stu-id="a373e-226">IdentityUserClaim</span></span> | <span data-ttu-id="a373e-227">AspnetUserClaims</span><span class="sxs-lookup"><span data-stu-id="a373e-227">AspnetUserClaims</span></span> | <span data-ttu-id="a373e-228">Id</span><span class="sxs-lookup"><span data-stu-id="a373e-228">Id</span></span> | <span data-ttu-id="a373e-229">사용자\_Id-&gt;AspnetUsers</span><span class="sxs-lookup"><span data-stu-id="a373e-229">User\_Id-&gt;AspnetUsers</span></span> |

<span data-ttu-id="a373e-230">이 정보를 사용 하 여 새 테이블을 만드는 SQL 문을 만들 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-230">With this information we can create SQL statements to create new tables.</span></span> <span data-ttu-id="a373e-231">각 문을 개별적으로 작성 하거나 필요에 따라 편집할 수 있는 EntityFramework PowerShell 명령을 사용 하 여 전체 스크립트를 생성할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-231">We can either write each statement individually or generate the entire script using EntityFramework PowerShell commands which we can then edit as required.</span></span> <span data-ttu-id="a373e-232">이렇게 하려면 VS의 **보기** 또는 **도구** 메뉴에서 **패키지 관리자 콘솔** 을 엽니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-232">To do this, in VS open the **Package Manager Console** from the **View** or **Tools** menu</span></span>

- <span data-ttu-id="a373e-233">"마이그레이션 사용" 명령을 실행 하 여 EntityFramework 마이그레이션을 사용 하도록 설정 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-233">Run command "Enable-Migrations" to enable EntityFramework migrations.</span></span>
- <span data-ttu-id="a373e-234">/Vb. C#데이터베이스를 만드는 초기 설정 코드를 만드는 "추가 마이그레이션 초기" 명령을 실행 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-234">Run command "Add-migration initial" which creates the initial setup code to create the database in C#/VB.</span></span>
- <span data-ttu-id="a373e-235">마지막 단계는 모델 클래스를 기반으로 SQL 스크립트를 생성 하는 "업데이트-데이터베이스 – 스크립트" 명령을 실행 하는 것입니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-235">The final step is to run "Update-Database –Script" command that generates the SQL script based on the model classes.</span></span>

[!INCLUDE[](../../../includes/identity/alter-command-exception.md)]

<span data-ttu-id="a373e-236">이 데이터베이스 생성 스크립트를 시작으로 사용 하 여 새 열을 추가 하 고 데이터를 복사할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-236">This database generation script can be used as a start where we'll be making additional changes to add new columns and copy data.</span></span> <span data-ttu-id="a373e-237">이를 사용 하면 이후 버전의 Id 릴리스에서 모델 클래스가 변경 될 때 EntityFramework가 데이터베이스 스키마를 수정 하는 데 사용 하는 `_MigrationHistory` 테이블을 생성 한다는 이점이 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-237">The advantage of this is that we generate the `_MigrationHistory` table which is used by EntityFramework to modify the database schema when the model classes change for future versions of Identity releases.</span></span>

<span data-ttu-id="a373e-238">SQL 멤버 자격 사용자 정보에는 Id 사용자 모델 클래스 (전자 메일, 암호 시도, 마지막 로그인 날짜, 마지막 잠금 날짜 등)와 다른 속성이 추가 되었습니다. 이 정보는 유용한 정보 이며 Id 시스템으로 전달 됩니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-238">The SQL membership user information had other properties in addition to the ones in the Identity user model class namely email, password attempts, last login date, last lock-out date etc. This is useful information and we would like it to be carried over to the Identity system.</span></span> <span data-ttu-id="a373e-239">이 작업을 수행 하려면 사용자 모델에 속성을 추가 하 고 데이터베이스의 테이블 열에 속성을 다시 매핑합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-239">This can be done by adding additional properties to the user model and mapping them back to the table columns in the database.</span></span> <span data-ttu-id="a373e-240">`IdentityUser` 모델을 서브 클래스 하는 클래스를 추가 하 여이 작업을 수행할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-240">We can do this by adding a class that subclasses the `IdentityUser` model.</span></span> <span data-ttu-id="a373e-241">이 사용자 지정 클래스에 속성을 추가 하 고 SQL 스크립트를 편집 하 여 테이블을 만들 때 해당 열을 추가할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-241">We can add the properties to this custom class and edit the SQL script to add the corresponding columns when creating the table.</span></span> <span data-ttu-id="a373e-242">이 클래스의 코드는 문서에 자세히 설명 되어 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-242">The code for this class is described further in the article.</span></span> <span data-ttu-id="a373e-243">새 속성을 추가한 후 `AspnetUsers` 테이블을 만들기 위한 SQL 스크립트는 다음과 같습니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-243">The SQL script for creating the `AspnetUsers` table after adding the new properties would be</span></span>

[!code-sql[Main](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/samples/sample1.sql)]

<span data-ttu-id="a373e-244">다음으로 SQL 멤버 자격 데이터베이스에서 Id에 대 한 새로 추가 된 테이블로 기존 정보를 복사 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-244">Next we need to copy the existing information from the SQL membership database to the newly added tables for Identity.</span></span> <span data-ttu-id="a373e-245">이 작업은 한 테이블에서 다른 테이블로 데이터를 직접 복사 하 여 SQL을 통해 수행할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-245">This can be done through SQL by copying data directly from one table to another.</span></span> <span data-ttu-id="a373e-246">테이블 행에 데이터를 추가 하려면 `INSERT INTO [Table]` 구문을 사용 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-246">To add data into the rows of table, we use the `INSERT INTO [Table]` construct.</span></span> <span data-ttu-id="a373e-247">다른 테이블에서 복사 하려면 `INSERT INTO` 문을 `SELECT` 문과 함께 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-247">To copy from another table we can use the `INSERT INTO` statement along with the `SELECT` statement.</span></span> <span data-ttu-id="a373e-248">사용자 정보를 모두 얻으려면 *aspnet\_사용자* 및 *Aspnet\_멤버 자격* 테이블을 쿼리하고 데이터를 *AspNetUsers* 테이블에 복사 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-248">To get all the user information we need to query the *aspnet\_Users* and *aspnet\_Membership* tables and copy the data to the *AspNetUsers* table.</span></span> <span data-ttu-id="a373e-249">`JOIN` 및 `LEFT OUTER JOIN` 문과 함께 `INSERT INTO` 및 `SELECT`를 사용 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-249">We use the `INSERT INTO` and `SELECT` along with `JOIN` and `LEFT OUTER JOIN` statements.</span></span> <span data-ttu-id="a373e-250">테이블 간에 데이터를 쿼리하고 복사 하는 방법에 대 한 자세한 내용은 [이](https://technet.microsoft.com/library/ms190750%28v=sql.105%29.aspx) 링크를 참조 하세요.</span><span class="sxs-lookup"><span data-stu-id="a373e-250">For more information about querying and copying data between tables, refer to [this](https://technet.microsoft.com/library/ms190750%28v=sql.105%29.aspx) link.</span></span> <span data-ttu-id="a373e-251">또한 AspnetUserLogins 및 AspnetUserClaims 테이블은 기본적으로이에 매핑되는 SQL 멤버 자격에 대 한 정보가 없으므로 시작 하기에는 비어 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-251">Additionally the AspnetUserLogins and AspnetUserClaims tables are empty to begin with since there is no information in SQL membership that maps to this by default.</span></span> <span data-ttu-id="a373e-252">사용자 및 역할에 대 한 정보만 복사 됩니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-252">The only information copied is for users and roles.</span></span> <span data-ttu-id="a373e-253">이전 단계에서 만든 프로젝트의 경우 사용자 테이블에 정보를 복사 하는 SQL 쿼리는 다음과 같습니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-253">For the project created in the previous steps, the SQL query to copy information to the users table would be</span></span>

[!code-sql[Main](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/samples/sample2.sql)]

<span data-ttu-id="a373e-254">위의 SQL 문에서 *aspnet\_사용자* 및 *Aspnet\_멤버 자격* 테이블의 각 사용자에 대 한 정보를 *AspnetUsers* 테이블의 열에 복사 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-254">In the above SQL statement, information about each user from the *aspnet\_Users* and *aspnet\_Membership* tables is copied into the columns of the *AspnetUsers* table.</span></span> <span data-ttu-id="a373e-255">여기에서 수행 하는 유일한 수정 사항은 암호를 복사 하는 것입니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-255">The only modification done here is when we copy the password.</span></span> <span data-ttu-id="a373e-256">SQL 멤버 자격의 암호에 대 한 암호화 알고리즘에서 ' PasswordSalt ' 및 ' Passwordsalt '을 사용 하므로 Id로 암호를 해독 하는 데 사용할 수 있도록 해시 된 암호와 함께이를 복사 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-256">Since the encryption algorithm for passwords in SQL membership used 'PasswordSalt' and 'PasswordFormat', we copy that too along with the hashed password so that it can be used to decrypt the password by Identity.</span></span> <span data-ttu-id="a373e-257">이에 대해서는 사용자 지정 암호 hasher를 연결 하는 경우 문서에 자세히 설명 되어 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-257">This is explained further in the article when hooking up a custom password hasher.</span></span>

<span data-ttu-id="a373e-258">이 스크립트 파일은이 샘플과 관련 된 것입니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-258">This script file is specific to this sample.</span></span> <span data-ttu-id="a373e-259">추가 테이블이 있는 응용 프로그램의 경우 개발자는 비슷한 방법을 따라 사용자 모델 클래스의 속성을 추가 하 고 AspnetUsers 테이블의 열에 매핑할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-259">For applications which have additional tables, developers can follow a similar approach to add additional properties on the user model class and map them to columns in the AspnetUsers table.</span></span> <span data-ttu-id="a373e-260">스크립트를 실행 하려면</span><span class="sxs-lookup"><span data-stu-id="a373e-260">To run the script,</span></span>

1. <span data-ttu-id="a373e-261">서버 탐색기를 엽니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-261">Open Server Explorer.</span></span> <span data-ttu-id="a373e-262">' ApplicationServices ' 연결을 확장 하 여 테이블을 표시 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-262">Expand the 'ApplicationServices' connection to display the tables.</span></span> <span data-ttu-id="a373e-263">테이블 노드를 마우스 오른쪽 단추로 클릭 하 고 ' 새 쿼리 ' 옵션을 선택 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-263">Right click on the Tables node and select the 'New Query' option</span></span>

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image7.png)
2. <span data-ttu-id="a373e-264">쿼리 창에서 전체 SQL 스크립트를 복사 하 여 migration .sql 파일에 붙여넣습니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-264">In the query window, copy and paste the entire SQL script from the Migrations.sql file.</span></span> <span data-ttu-id="a373e-265">' 실행 ' 화살표 단추를 눌러 스크립트 파일을 실행 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-265">Run the script file by hitting the 'Execute' arrow button.</span></span>

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image4.jpg)

    <span data-ttu-id="a373e-266">서버 탐색기 창을 새로 고칩니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-266">Refresh the Server Explorer window.</span></span> <span data-ttu-id="a373e-267">데이터베이스에 5 개의 새 테이블이 생성 됩니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-267">Five new tables are created in the database.</span></span>

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image8.png)

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image9.png)

    <span data-ttu-id="a373e-268">다음은 SQL 멤버 자격 테이블의 정보가 새 Id 시스템에 매핑되는 방법입니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-268">Below is how the information in the SQL membership tables are mapped to the new Identity system.</span></span>

    <span data-ttu-id="a373e-269">aspnet\_역할-&gt; AspNetRoles</span><span class="sxs-lookup"><span data-stu-id="a373e-269">aspnet\_Roles --&gt; AspNetRoles</span></span>

    <span data-ttu-id="a373e-270">asp.net\_netUsers 및 asp\_Netusers--&gt; AspNetUsers</span><span class="sxs-lookup"><span data-stu-id="a373e-270">asp\_netUsers and asp\_netMembership --&gt; AspNetUsers</span></span>

    <span data-ttu-id="a373e-271">aspnet\_UserInRoles--&gt; AspNetUserRoles</span><span class="sxs-lookup"><span data-stu-id="a373e-271">aspnet\_UserInRoles --&gt; AspNetUserRoles</span></span>

    <span data-ttu-id="a373e-272">위의 섹션에서 설명한 대로 AspNetUserClaims 및 AspNetUserLogins 테이블은 비어 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-272">As explained in the above section, the AspNetUserClaims and AspNetUserLogins tables are empty.</span></span> <span data-ttu-id="a373e-273">AspNetUser 테이블의 ' 판별자 ' 필드는 다음 단계로 정의 된 모델 클래스 이름과 일치 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-273">The 'Discriminator' field in the AspNetUser table should match the model class name which is defined as a next step.</span></span> <span data-ttu-id="a373e-274">또한 PasswordHash 열은 ' 암호화 된 암호 | 암호 솔트 | 암호 형식 ' 형식입니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-274">Also the PasswordHash column is in the form 'encrypted password |password salt|password format'.</span></span> <span data-ttu-id="a373e-275">이렇게 하면 이전 암호를 다시 사용할 수 있도록 특별 한 SQL 멤버 자격 암호화 논리를 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-275">This enables you to use special SQL membership crypto logic so that you can reuse old passwords.</span></span> <span data-ttu-id="a373e-276">이에 대해서는이 문서의 뒷부분에서 설명 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-276">That is explained in later in the article.</span></span>

### <a name="creating-models-and-membership-pages"></a><span data-ttu-id="a373e-277">모델 및 멤버 자격 페이지 만들기</span><span class="sxs-lookup"><span data-stu-id="a373e-277">Creating models and membership pages</span></span>

<span data-ttu-id="a373e-278">앞에서 설명한 대로 Id 기능은 Entity Framework를 사용 하 여 기본적으로 계정 정보를 저장 하기 위해 데이터베이스와 통신 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-278">As mentioned earlier, the Identity feature uses Entity Framework to talk to the database for storing account information by default.</span></span> <span data-ttu-id="a373e-279">테이블의 기존 데이터로 작업 하려면 테이블에 다시 매핑하고 Id 시스템에 후크 하는 모델 클래스를 만들어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-279">To work with existing data in the table, we need to create model classes which map back to the tables and hook them up in the Identity system.</span></span> <span data-ttu-id="a373e-280">Id 계약의 일부로 모델 클래스는 Id. Core dll에 정의 된 인터페이스를 구현 하거나, Microsoft. AspNet. i d. EntityFramework에서 사용할 수 있는 이러한 인터페이스의 기존 구현을 확장할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-280">As part of the Identity contract, the model classes should either implement the interfaces defined in the Identity.Core dll or can extend the existing implementation of these interfaces available in Microsoft.AspNet.Identity.EntityFramework.</span></span>

<span data-ttu-id="a373e-281">이 샘플에서 AspNetRoles, AspNetUserClaims, AspNetLogins 및 AspNetUserRole 테이블은 기존 Id 시스템 구현과 유사한 열을 포함 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-281">In our sample, the AspNetRoles, AspNetUserClaims, AspNetLogins and AspNetUserRole tables have columns that are similar to the existing implementation of the Identity system.</span></span> <span data-ttu-id="a373e-282">따라서 기존 클래스를 다시 사용 하 여 이러한 테이블에 매핑할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-282">Hence we can reuse the existing classes to map to these tables.</span></span> <span data-ttu-id="a373e-283">AspNetUser 테이블에는 SQL 멤버 자격 테이블의 추가 정보를 저장 하는 데 사용 되는 몇 가지 추가 열이 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-283">The AspNetUser table has some additional columns which are used to store additional information from the SQL membership tables.</span></span> <span data-ttu-id="a373e-284">' IdentityUser '의 기존 구현을 확장 하 고 추가 속성을 추가 하는 모델 클래스를 만들어이를 매핑할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-284">This can be mapped by creating a model class that extend the existing implementation of 'IdentityUser' and add the additional properties.</span></span>

1. <span data-ttu-id="a373e-285">프로젝트에서 모델 폴더를 만들고 클래스 사용자를 추가 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-285">Create a Models folder in the project and add a class User.</span></span> <span data-ttu-id="a373e-286">클래스의 이름은 ' AspnetUsers ' 테이블의 ' 판별자 ' 열에 추가 된 데이터와 일치 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-286">The name of the class should match the data added in the 'Discriminator' column of 'AspnetUsers' table.</span></span>

    ![](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/_static/image10.png)

    <span data-ttu-id="a373e-287">사용자 클래스는 IdentityUser *프레임 워크* dll에 있는 클래스를 확장 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-287">The User class should extend the IdentityUser class found in the *Microsoft.AspNet.Identity.EntityFramework* dll.</span></span> <span data-ttu-id="a373e-288">AspNetUser 열에 다시 매핑되는 클래스의 속성을 선언 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-288">Declare the properties in class that map back to the AspNetUser columns.</span></span> <span data-ttu-id="a373e-289">속성 ID, 사용자 이름, PasswordHash 및 SecurityStamp는 IdentityUser에 정의 되므로 생략 됩니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-289">The properties ID, Username, PasswordHash and SecurityStamp are defined in the IdentityUser and so are omitted.</span></span> <span data-ttu-id="a373e-290">다음은 모든 속성을 포함 하는 사용자 클래스에 대 한 코드입니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-290">Below is the code for the User class that has all the properties</span></span>

    [!code-csharp[Main](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/samples/sample3.cs)]
2. <span data-ttu-id="a373e-291">모델의 데이터를 테이블에 다시 저장 하 고 테이블에서 데이터를 검색 하 여 모델을 채우도록 Entity Framework DbContext 클래스가 필요 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-291">An Entity Framework DbContext class is required in order to persist data in models back to tables and retrieve data from tables to populate the models.</span></span> <span data-ttu-id="a373e-292">IdentityDbContext는 Id 테이블과 상호 작용 하 여 정보를 검색 하 고 저장 하는 클래스를 정의 *합니다.*</span><span class="sxs-lookup"><span data-stu-id="a373e-292">*Microsoft.AspNet.Identity.EntityFramework* dll defines the IdentityDbContext class which interacts with the Identity tables to retrieve and store information.</span></span> <span data-ttu-id="a373e-293">IdentityDbContext&lt;tuser&gt;은 IdentityUser 클래스를 확장 하는 클래스 일 수 있는 ' TUser ' 클래스를 사용 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-293">The IdentityDbContext&lt;tuser&gt; takes a 'TUser' class which can be any class that extends the IdentityUser class.</span></span>

    <span data-ttu-id="a373e-294">' 모델 ' 폴더에서 IdentityDbContext를 확장 하 고 1 단계에서 만든 ' User ' 클래스를 전달 하는 새 클래스 ApplicationDBContext를 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-294">Create a new class ApplicationDBContext that extends IdentityDbContext under the 'Models' folder, passing in the 'User' class created in step 1</span></span>

    [!code-csharp[Main](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/samples/sample4.cs)]
3. <span data-ttu-id="a373e-295">새 Id 시스템의 사용자 관리&gt;&lt;는 *Microsoft. n.* n e t. n e t. n e t. n e t. n e t. n e t. n e t. n e t.</span><span class="sxs-lookup"><span data-stu-id="a373e-295">User management in the new Identity system is done using the UserManager&lt;tuser&gt; class defined in the *Microsoft.AspNet.Identity.EntityFramework* dll.</span></span> <span data-ttu-id="a373e-296">1 단계에서 만든 ' User ' 클래스를 전달 하 여 UserManager를 확장 하는 사용자 지정 클래스를 만들어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-296">We need to create a custom class that extends UserManager, passing in the 'User' class created in step 1.</span></span>

    <span data-ttu-id="a373e-297">모델 폴더에서 UserManager&lt;사용자를 확장 하는 새 클래스 UserManager를 만듭니다&gt;</span><span class="sxs-lookup"><span data-stu-id="a373e-297">In the Models folder create a new class UserManager that extends UserManager&lt;user&gt;</span></span>

    [!code-csharp[Main](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/samples/sample5.cs)]
4. <span data-ttu-id="a373e-298">응용 프로그램 사용자의 암호는 암호화 되어 데이터베이스에 저장 됩니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-298">The passwords of the users of the application are encrypted and stored in the database.</span></span> <span data-ttu-id="a373e-299">SQL 멤버 자격에 사용 되는 암호화 알고리즘은 새 Id 시스템의 암호화 알고리즘과 다릅니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-299">The crypto algorithm used in SQL membership is different from the one in the new Identity system.</span></span> <span data-ttu-id="a373e-300">이전 암호를 다시 사용 하려면 이전 사용자가 SQL 멤버 자격 알고리즘을 사용 하 여 로그인 할 때 암호를 선택적으로 해독 해야 하며, 새 사용자의 경우 Id로 암호화 알고리즘을 사용 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-300">To reuse old passwords we need to selectively decrypt passwords when old users log in using the SQL memberships algorithm while using the crypto algorithm in Identity for the new users.</span></span>

    <span data-ttu-id="a373e-301">UserManager 클래스에는 ' IPasswordHasher ' 인터페이스를 구현 하는 클래스의 인스턴스를 저장 하는 ' PasswordHasher ' 속성이 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-301">The UserManager class has a property 'PasswordHasher' which stores an instance of a class that implements the 'IPasswordHasher' interface.</span></span> <span data-ttu-id="a373e-302">사용자 인증 트랜잭션 중에 암호를 암호화/암호 해독 하는 데 사용 됩니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-302">This is used to encrypt/decrypt passwords during user authentication transactions.</span></span> <span data-ttu-id="a373e-303">3 단계에서 정의한 UserManager 클래스에서 새 클래스 SQLPasswordHasher를 만들고 아래 코드를 복사 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-303">In the UserManager class defined in step 3, create a new class SQLPasswordHasher and copy the below code.</span></span>

    [!code-csharp[Main](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/samples/sample6.cs)]

    <span data-ttu-id="a373e-304">System.string 및 system.servicemodel 네임 스페이스를 가져와서 컴파일 오류를 해결 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-304">Resolve the compilation errors by importing the System.Text and System.Security.Cryptography namespaces.</span></span>

    <span data-ttu-id="a373e-305">EncodePassword 메서드는 기본 SQL 멤버 자격 암호화 구현에 따라 암호를 암호화 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-305">The EncodePassword method encrypts the password according to the default SQL membership crypto implementation.</span></span> <span data-ttu-id="a373e-306">이는 System.web dll에서 가져옵니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-306">This is taken from the System.Web dll.</span></span> <span data-ttu-id="a373e-307">이전 앱에서 사용자 지정 구현을 사용한 경우 여기에 반영 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-307">If the old app used a custom implementation then it should be reflected here.</span></span> <span data-ttu-id="a373e-308">*EncodePassword* 메서드를 사용 하 여 지정 된 암호를 해시 하거나 데이터베이스에 있는 기존 암호를 사용 하 여 일반 텍스트 암호를 확인 하는 두 가지 다른 메서드인 *Hashpassword* 및 *verifyhashedpassword* 를 정의 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-308">We need to define two other methods *HashPassword* and *VerifyHashedPassword* that use the *EncodePassword* method to hash a given password or verify a plain text password with the one existing in the database.</span></span>

    <span data-ttu-id="a373e-309">SQL 멤버 자격 시스템은 PasswordHash, PasswordSalt 및 Passwordsalt을 사용 하 여 암호를 등록 하거나 변경할 때 사용자가 입력 한 암호를 해시 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-309">The SQL membership system used PasswordHash, PasswordSalt and PasswordFormat to hash the password entered by users when they register or change their password.</span></span> <span data-ttu-id="a373e-310">마이그레이션하는 동안 세 필드는 모두 ' | ' 문자로 구분 된 AspNetUser 테이블의 PasswordHash 열에 저장 됩니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-310">During the migration all the three fields are stored in the PasswordHash column in the AspNetUser table separated by the '|' character.</span></span> <span data-ttu-id="a373e-311">사용자가 로그인 하 고 암호에 이러한 필드가 있는 경우 SQL 멤버 자격 암호화를 사용 하 여 암호를 확인 합니다. 그렇지 않으면 Id 시스템의 기본 암호화를 사용 하 여 암호를 확인 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-311">When a user logs in and the password has these fields, we use the SQL membership crypto to check the password; otherwise we use the Identity system's default crypto to verify the password.</span></span> <span data-ttu-id="a373e-312">이렇게 하면 앱이 마이그레이션되면 이전 사용자가 암호를 변경할 필요가 없습니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-312">This way old users would not have to change their passwords once the app is migrated.</span></span>
5. <span data-ttu-id="a373e-313">UserManager 클래스의 생성자를 선언 하 고 생성자의 속성에 SQLPasswordHasher로 전달 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-313">Declare the constructor for the UserManager class and pass this as the SQLPasswordHasher to the property in the constructor.</span></span>

    [!code-csharp[Main](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/samples/sample7.cs)]

### <a name="create-new-account-management-pages"></a><span data-ttu-id="a373e-314">새 계정 관리 페이지 만들기</span><span class="sxs-lookup"><span data-stu-id="a373e-314">Create new account management pages</span></span>

<span data-ttu-id="a373e-315">마이그레이션의 다음 단계는 사용자가 등록 하 고 로그인 할 수 있는 계정 관리 페이지를 추가 하는 것입니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-315">The next step in the migration is to add account management pages that will let a user register and log in.</span></span> <span data-ttu-id="a373e-316">SQL 멤버 자격의 이전 계정 페이지는 새 Id 시스템에서 작동 하지 않는 컨트롤을 사용 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-316">The old account pages from SQL membership use controls that don't work with the new Identity system.</span></span> <span data-ttu-id="a373e-317">새 사용자 관리 페이지를 추가 하려면 프로젝트를 이미 만들었고 NuGet 패키지를 추가 했으므로 ' 응용 프로그램에 사용자를 등록 하기 위한 Web Forms 추가 ' 단계에서 시작 하 [https://www.asp.net/identity/overview/getting-started/adding-aspnet-identity-to-an-empty-or-existing-web-forms-project](../getting-started/adding-aspnet-identity-to-an-empty-or-existing-web-forms-project.md) 이 링크의 자습서를 따르세요.</span><span class="sxs-lookup"><span data-stu-id="a373e-317">To add the new user management pages follow the tutorial at this link [https://www.asp.net/identity/overview/getting-started/adding-aspnet-identity-to-an-empty-or-existing-web-forms-project](../getting-started/adding-aspnet-identity-to-an-empty-or-existing-web-forms-project.md) starting from the step 'Adding Web Forms for registering users to your application' since we have already created the project and added the NuGet packages.</span></span>

<span data-ttu-id="a373e-318">여기에 있는 프로젝트를 사용 하려면 샘플에 대 한 몇 가지 변경 작업을 수행 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-318">We need to make some changes for the sample to work with the project we have here.</span></span>

- <span data-ttu-id="a373e-319">Register.aspx.cs 및 Login.aspx.cs 코드 뒤 클래스는 Id 패키지의 `UserManager`를 사용 하 여 사용자를 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-319">The Register.aspx.cs and Login.aspx.cs code behind classes use the `UserManager` from the Identity packages to create a User.</span></span> <span data-ttu-id="a373e-320">이 예에서는 앞에서 설명한 단계를 수행 하 여 모델 폴더에 추가 된 UserManager를 사용 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-320">For this example use the UserManager added in the Models folder by following the steps mentioned earlier.</span></span>
- <span data-ttu-id="a373e-321">Register.aspx.cs 및 Login.aspx.cs 코드 뒤 클래스에서 IdentityUser 대신 만들어진 사용자 클래스를 사용 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-321">Use the User class created instead of the IdentityUser in Register.aspx.cs and Login.aspx.cs code behind classes.</span></span> <span data-ttu-id="a373e-322">사용자 지정 사용자 클래스에서 Id 시스템으로 후크 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-322">This hooks in our custom user class into the Identity system.</span></span>
- <span data-ttu-id="a373e-323">데이터베이스를 만드는 부분은 건너뛸 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-323">The part to create the database can be skipped.</span></span>
- <span data-ttu-id="a373e-324">개발자는 새 사용자의 ApplicationId를 현재 응용 프로그램 ID와 일치 하도록 설정 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-324">The developer needs to set the ApplicationId for the new user to match the current application ID.</span></span> <span data-ttu-id="a373e-325">이 작업을 수행 하려면 Register.aspx.cs 클래스에서 사용자 개체가 만들어지기 전에이 응용 프로그램에 대 한 ApplicationId를 쿼리하고 사용자를 만들기 전에 설정 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-325">This can be done by querying the ApplicationId for this application before a user object is created in the Register.aspx.cs class and setting it before creating user.</span></span>

    <span data-ttu-id="a373e-326">예제:</span><span class="sxs-lookup"><span data-stu-id="a373e-326">Example:</span></span>

    <span data-ttu-id="a373e-327">Register.aspx.cs 페이지에서 메서드를 정의 하 여 aspnet\_응용 프로그램 테이블을 쿼리하고 응용 프로그램 이름에 따라 응용 프로그램 Id를 가져옵니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-327">Define a method in Register.aspx.cs page to query the aspnet\_Applications table and get the application Id according to application name</span></span>

    [!code-csharp[Main](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/samples/sample8.cs)]

    <span data-ttu-id="a373e-328">이제 사용자 개체에 대해 설정 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-328">Now get set this on the user object</span></span>

    [!code-csharp[Main](migrating-an-existing-website-from-sql-membership-to-aspnet-identity/samples/sample9.cs)]

<span data-ttu-id="a373e-329">이전 사용자 이름 및 암호를 사용 하 여 기존 사용자에 게 로그인 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-329">Use the old username and password to login an existing user.</span></span> <span data-ttu-id="a373e-330">등록 페이지를 사용 하 여 새 사용자를 만들 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-330">Use the Register page to create a new user.</span></span> <span data-ttu-id="a373e-331">또한 사용자가 예상 대로 역할에 있는지 확인 합니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-331">Also verify that the users are in roles as expected.</span></span>

<span data-ttu-id="a373e-332">Id 시스템으로 이식 하면 사용자가 응용 프로그램에 대 한 OAuth (Open Authentication)를 추가할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-332">Porting to the Identity system helps the user add Open Authentication (OAuth) to the application.</span></span> <span data-ttu-id="a373e-333">OAuth가 설정 [된 예제를](https://github.com/aspnet/samples/tree/master/samples/aspnet/Identity/SQLMembership-Identity-OWIN/) 참조 하세요.</span><span class="sxs-lookup"><span data-stu-id="a373e-333">Please refer to the sample [here](https://github.com/aspnet/samples/tree/master/samples/aspnet/Identity/SQLMembership-Identity-OWIN/) which has OAuth enabled.</span></span>

## <a name="next-steps"></a><span data-ttu-id="a373e-334">다음 단계</span><span class="sxs-lookup"><span data-stu-id="a373e-334">Next Steps</span></span>

<span data-ttu-id="a373e-335">이 자습서에서는 사용자를 SQL 멤버 자격에서 ASP.NET Identity로 이식 하는 방법을 살펴보았습니다. 하지만 프로필 데이터를 이식 하지 않았습니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-335">In this tutorial we showed how to port users from SQL membership to ASP.NET Identity, but we didn't port Profile data.</span></span> <span data-ttu-id="a373e-336">다음 자습서에서는 SQL 멤버 자격에서 새 Id 시스템으로 프로필 데이터 포팅에 대해 살펴봅니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-336">In the next tutorial we'll look into porting Profile data from SQL membership to the new Identity system.</span></span>

<span data-ttu-id="a373e-337">이 문서의 맨 아래에 의견을 남길 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a373e-337">You can leave feedback at the bottom of this article.</span></span>

<span data-ttu-id="a373e-338">*문서를 검토 하기 위한 Tom Dykstra 및 Rick Anderson에 감사 합니다.*</span><span class="sxs-lookup"><span data-stu-id="a373e-338">*Thanks to Tom Dykstra and Rick Anderson for reviewing the article.*</span></span>
